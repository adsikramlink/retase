<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efektivitas Running (Input Manual)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        /* Custom scrollbar untuk tampilan lebih rapi */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }

        .unit-input {
             @apply p-2 border-2 border-gray-500 bg-white rounded-md text-right font-semibold shadow-sm focus:ring-2 focus:ring-opacity-50;
        }
        .output-display {
            @apply p-2 bg-gray-200 rounded-md text-right font-extrabold text-red-700 pointer-events-none border border-gray-400 shadow-inner;
        }
        
        /* Style input time agar konsisten */
        input[type="time"] {
            font-family: 'Inter', sans-serif;
            cursor: pointer;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl">
        <header class="mb-6">
            <h1 class="text-3xl font-extrabold text-gray-900 border-b pb-2">Efektivitas Running</h1>
            <p class="text-sm text-gray-500 mt-2">Kalkulator Durasi Conveyor dan Perhitungan Unit Running.</p>
        </header>

        <div class="mb-12">
            <h2 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">0. Data Operasi (CHP OPERATION)</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="inputShift" class="block text-sm font-medium text-gray-700">Shift:</label>
                        <select id="inputShift" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm font-semibold focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="NIGHT SHIFT">NIGHT SHIFT</option>
                            <option value="DAY SHIFT">DAY SHIFT</option>
                        </select>
                    </div>
                    <div>
                        <label for="inputTanggal" class="block text-sm font-medium text-gray-700">Tanggal:</label>
                        <input type="date" id="inputTanggal" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm font-semibold focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Supervisor (Pilih 1 atau lebih):</label>
                        <div id="spvCheckboxes" class="flex flex-wrap gap-x-4 gap-y-1 mt-1 p-2 border border-gray-300 rounded-md bg-gray-50"></div>
                    </div>
                    <div class="w-full">
                        <label for="inputSupervisorLainnya" class="block text-sm font-medium text-gray-700">Supervisor Lainnya (Opsional):</label>
                        <input type="text" id="inputSupervisorLainnya" placeholder="Cth: Rudi B & Jono S" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Foreman (Pilih 1 atau lebih):</label>
                        <div id="foremanCheckboxes" class="flex flex-wrap gap-x-4 gap-y-1 mt-1 p-2 border border-gray-300 rounded-md bg-gray-50"></div>
                    </div>
                    <div class="w-full">
                        <label for="inputForemanLainnya" class="block text-sm font-medium text-gray-700">Foreman Lainnya (Opsional):</label>
                        <input type="text" id="inputForemanLainnya" placeholder="Cth: Dedi S & Agus P" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Checker (Pilih 1 atau lebih):</label>
                        <div id="checkerCheckboxes" class="flex flex-wrap gap-x-4 gap-y-1 mt-1 p-2 border border-gray-300 rounded-md bg-gray-50"></div>
                    </div>
                    <div class="w-full">
                        <label for="inputCheckerLainnya" class="block text-sm font-medium text-gray-700">Checker Lainnya (Opsional):</label>
                        <input type="text" id="inputCheckerLainnya" placeholder="Cth: Iwan A & Dani B" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200">
                    <div>
                        <label for="inputTippingRom" class="block text-sm font-medium text-gray-700">TIPPING ROM (Trip):</label>
                        <input type="number" id="inputTippingRom" min="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm text-right font-semibold">
                    </div>
                    <div>
                        <label for="inputTransferRom" class="block text-sm font-medium text-gray-700">TRANSFER ROM (Trip):</label>
                        <input type="number" id="inputTransferRom" min="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm text-right font-semibold">
                    </div>
                </div>
            </div>
        </div>

        <h2 class="text-xl font-bold text-gray-800 mb-3">1. Durasi Conveyor (Input Manual)</h2>

        <div class="mb-4">
            <label for="sdSelector" class="block text-sm font-medium text-gray-700 mb-1">Pilih Conveyor:</label>
            <select id="sdSelector" onchange="showTab(this.value)" class="w-full sm:w-1/3 p-3 border border-gray-300 rounded-lg text-base shadow-sm font-semibold focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                <option value="SD1">SD1</option>
                <option value="SD2">SD2</option>
                <option value="SD3">SD3</option>
            </select>
        </div>
        
        <div id="tab-content-container">
            <div id="SD1-content" class="tab-content">
                <div class="hidden sm:grid grid-cols-12 gap-4 text-sm font-bold text-gray-700 mb-2 border-b pb-2">
                    <div class="col-span-1 text-center">No.</div>
                    <div class="col-span-5 text-center">Waktu Mulai</div>
                    <div class="col-span-4 text-center">Waktu Selesai</div>
                    <div class="col-span-1 text-center">Durasi</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="entriesContainer-SD1" class="space-y-4"></div>
            </div>

            <div id="SD2-content" class="tab-content hidden">
                <div class="hidden sm:grid grid-cols-12 gap-4 text-sm font-bold text-gray-700 mb-2 border-b pb-2">
                    <div class="col-span-1 text-center">No.</div>
                    <div class="col-span-5 text-center">Waktu Mulai</div>
                    <div class="col-span-4 text-center">Waktu Selesai</div>
                    <div class="col-span-1 text-center">Durasi</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="entriesContainer-SD2" class="space-y-4"></div>
            </div>

            <div id="SD3-content" class="tab-content hidden">
                <div class="hidden sm:grid grid-cols-12 gap-4 text-sm font-bold text-gray-700 mb-2 border-b pb-2">
                    <div class="col-span-1 text-center">No.</div>
                    <div class="col-span-5 text-center">Waktu Mulai</div>
                    <div class="col-span-4 text-center">Waktu Selesai</div>
                    <div class="col-span-1 text-center">Durasi</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="entriesContainer-SD3" class="space-y-4"></div>
            </div>
            
            <button type="button" onclick="addEntry(activeSD)" class="w-full sm:w-auto flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 mt-6">
                + Tambah Baris Waktu
            </button>
        </div>


        <div id="results" class="mt-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">HASIL DURASI CONVEYOR</h2>

            <div id="sd-results-container" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-0 bg-transparent">
                    <h3 class="font-bold text-lg text-blue-700 mb-2 border-b pb-1">SD1</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-600">Total Durasi:</span>
                            <span id="totalDisplay-SD1" class="font-extrabold text-red-600">0 Jam 0 Menit</span>
                        </div>
                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="font-bold text-gray-800">SISA (EFEKTIVITAS):</span>
                            <span id="remainingDisplay-SD1" class="font-extrabold text-green-600">12 Jam 0 Menit</span>
                        </div>
                    </div>
                </div>
                <div class="p-0 bg-transparent">
                    <h3 class="font-bold text-lg text-blue-700 mb-2 border-b pb-1">SD2</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-600">Total Durasi:</span>
                            <span id="totalDisplay-SD2" class="font-extrabold text-red-600">0 Jam 0 Menit</span>
                        </div>
                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="font-bold text-gray-800">SISA (EFEKTIVITAS):</span>
                            <span id="remainingDisplay-SD2" class="font-extrabold text-green-600">12 Jam 0 Menit</span>
                        </div>
                    </div>
                </div>
                <div class="p-0 bg-transparent">
                    <h3 class="font-bold text-lg text-blue-700 mb-2 border-b pb-1">SD3</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-600">Total Durasi:</span>
                            <span id="totalDisplay-SD3" class="font-extrabold text-red-600">0 Jam 0 Menit</span>
                        </div>
                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="font-bold text-gray-800">SISA (EFEKTIVITAS):</span>
                            <span id="remainingDisplay-SD3" class="font-extrabold text-green-600">12 Jam 0 Menit</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-3">2. Perhitungan Unit Running</h2>

            <div class="space-y-6">
                <div id="mha-section" class="p-4 rounded-lg bg-white shadow border border-orange-300">
                    <h3 class="text-xl font-bold text-orange-700 mb-4">1. MHA</h3>
                    <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                        <div class="border-b border-gray-200 sm:border-b-0 pb-3 sm:pb-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT SIANG</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Siang:</label>
                                <input type="number" id="mha-running-siang" min="0" oninput="calculateUnitResult('mha')" class="unit-input w-full focus:ring-orange-200">
                                <label class="block font-medium text-gray-600 pt-2 text-sm">Trip Unit Siang:</label>
                                <input type="number" id="mha-trip-siang" min="0" oninput="calculateUnitResult('mha')" class="unit-input w-full focus:ring-orange-200">
                            </div>
                        </div>
                        <div class="sm:border-l sm:pl-6 pt-3 sm:pt-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT MALAM</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Malam:</label>
                                <input type="number" id="mha-running-malam" min="0" oninput="calculateUnitResult('mha')" class="unit-input w-full focus:ring-orange-200">
                                <div class="grid grid-cols-2 gap-2 mt-2 items-end">
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1">Trip Unit Malam:</label>
                                        <input type="number" id="mha-trip-malam" min="0" oninput="calculateUnitResult('mha')" class="unit-input focus:ring-orange-200">
                                    </div>
                                    <div class="flex flex-col">
                                        <span id="mha-trip-selisih-inline" class="output-display w-full">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t-2 border-orange-500 grid grid-cols-2 gap-3">
                        <div class="p-3 bg-orange-100 rounded-lg">
                            <span class="font-bold text-orange-800 block text-sm">Hasil 2 Trip (Siang):</span>
                            <span id="mha-hasil-siang" class="font-extrabold text-xl sm:text-2xl text-red-600">0</span>
                        </div>
                        <div class="p-3 bg-orange-100 rounded-lg">
                            <span class="font-bold text-orange-800 block text-sm">Hasil 2 Trip (Malam):</span>
                            <span id="mha-hasil-malam" class="font-extrabold text-xl sm:text-2xl text-red-700">0</span>
                        </div>
                    </div>
                </div>
                
                <div id="karunia-section" class="p-4 rounded-lg bg-white shadow border border-green-300">
                    <h3 class="text-xl font-bold text-green-700 mb-4">2. KARUNIA</h3>
                    <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                        <div class="border-b border-gray-200 sm:border-b-0 pb-3 sm:pb-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT SIANG</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Siang:</label>
                                <input type="number" id="karunia-running-siang" min="0" oninput="calculateUnitResult('karunia')" class="unit-input w-full focus:ring-green-200">
                                <label class="block font-medium text-gray-600 pt-2 text-sm">Trip Unit Siang:</label>
                                <input type="number" id="karunia-trip-siang" min="0" oninput="calculateUnitResult('karunia')" class="unit-input w-full focus:ring-green-200">
                            </div>
                        </div>
                        <div class="sm:border-l sm:pl-6 pt-3 sm:pt-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT MALAM</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Malam:</label>
                                <input type="number" id="karunia-running-malam" min="0" oninput="calculateUnitResult('karunia')" class="unit-input w-full focus:ring-green-200">
                                <div class="grid grid-cols-2 gap-2 mt-2 items-end">
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1">Trip Unit Malam:</label>
                                        <input type="number" id="karunia-trip-malam" min="0" oninput="calculateUnitResult('karunia')" class="unit-input focus:ring-green-200">
                                    </div>
                                    <div class="flex flex-col">
                                        <span id="karunia-trip-selisih-inline" class="output-display w-full">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t-2 border-green-500 grid grid-cols-2 gap-3">
                        <div class="p-3 bg-green-100 rounded-lg">
                            <span class="font-bold text-green-800 block text-sm">Hasil 2 Trip (Siang):</span>
                            <span id="karunia-hasil-siang" class="font-extrabold text-xl sm:text-2xl text-red-600">0</span>
                        </div>
                        <div class="p-3 bg-green-100 rounded-lg">
                            <span class="font-bold text-green-800 block text-sm">Hasil 2 Trip (Malam):</span>
                            <span id="karunia-hasil-malam" class="font-extrabold text-xl sm:text-2xl text-red-700">0</span>
                        </div>
                    </div>
                </div>
                
                <div id="buma-section" class="p-4 rounded-lg bg-white shadow border border-yellow-300">
                    <h3 class="text-xl font-bold text-yellow-700 mb-4">3. BUMA</h3>
                    <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                        <div class="border-b border-gray-200 sm:border-b-0 pb-3 sm:pb-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT SIANG</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Siang:</label>
                                <input type="number" id="buma-running-siang" min="0" oninput="calculateUnitResult('buma')" class="unit-input w-full focus:ring-yellow-200">
                                <label class="block font-medium text-gray-600 pt-2 text-sm">Trip Unit Siang:</label>
                                <input type="number" id="buma-trip-siang" min="0" oninput="calculateUnitResult('buma')" class="unit-input w-full focus:ring-yellow-200">
                            </div>
                        </div>
                        <div class="sm:border-l sm:pl-6 pt-3 sm:pt-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT MALAM</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Malam:</label>
                                <input type="number" id="buma-running-malam" min="0" oninput="calculateUnitResult('buma')" class="unit-input w-full focus:ring-yellow-200">
                                <div class="grid grid-cols-2 gap-2 mt-2 items-end">
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1">Trip Unit Malam:</label>
                                        <input type="number" id="buma-trip-malam" min="0" oninput="calculateUnitResult('buma')" class="unit-input focus:ring-yellow-200">
                                    </div>
                                    <div class="flex flex-col">
                                        <span id="buma-trip-selisih-inline" class="output-display w-full">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t-2 border-yellow-500 grid grid-cols-2 gap-3">
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <span class="font-bold text-yellow-800 block text-sm">Hasil 2 Trip (Siang):</span>
                            <span id="buma-hasil-siang" class="font-extrabold text-xl sm:text-2xl text-red-600">0</span>
                        </div>
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <span class="font-bold text-yellow-800 block text-sm">Hasil 2 Trip (Malam):</span>
                            <span id="buma-hasil-malam" class="font-extrabold text-xl sm:text-2xl text-red-700">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-5 bg-indigo-50 border-2 border-indigo-400 rounded-lg shadow-md">
                <h3 class="text-xl font-bold text-indigo-800 mb-3 border-b pb-2">HASIL Total Trip</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-lg text-gray-700">Total Trip Unit Siang:</span>
                        <span id="grand-total-trip-siang" class="font-extrabold text-2xl text-indigo-600">0</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-indigo-200">
                        <span class="font-semibold text-lg text-gray-700">Total Trip Unit Malam:</span>
                        <span id="grand-total-trip-malam" class="font-extrabold text-2xl text-indigo-600">0</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-indigo-200">
                        <span class="font-semibold text-lg text-gray-700">Selisih (Malam - Siang):</span>
                        <span id="grand-total-trip-difference" class="font-extrabold text-2xl text-red-600">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-12 p-6 bg-purple-100 rounded-xl shadow-2xl border border-purple-400">
            <h2 class="text-2xl font-bold text-purple-800 mb-4 border-b pb-3">SALIN LAPORAN LENGKAP</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button type="button" onclick="copyDailyReportSiang()" class="w-full bg-purple-600 text-white py-4 px-4 rounded-xl hover:bg-purple-700 transition duration-150 font-extrabold shadow-lg text-lg focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-offset-2">
                    Laporan Harian SIANG
                </button>
                <button type="button" onclick="copyDailyReportMalam()" class="w-full bg-purple-900 text-white py-4 px-4 rounded-xl hover:bg-purple-950 transition duration-150 font-extrabold shadow-lg text-lg focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-offset-2">
                    Laporan Harian MALAM
                </button>
            </div>
        </div>

        <div id="messageBox" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden" onclick="hideMessage()">
            <div class="bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full mx-4" onclick="event.stopPropagation()">
                <h3 id="messageTitle" class="text-lg font-bold text-gray-900 mb-2"></h3>
                <p id="messageContent" class="text-gray-700 mb-4"></p>
                <button onclick="hideMessage()" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        // --- DEKLARASI GLOBAL & DATA ---
        let entryCount = { SD1: 0, SD2: 0, SD3: 0 };
        const entryData = { SD1: [], SD2: [], SD3: [] };
        let activeSD = 'SD1';
        const SPV_LIST = ['Ihsan R', 'Dicky F', 'Sopian']; 
        const FOREMAN_LIST = ['Gunawan TC', 'Hardiansyah', 'Lewi S', 'Elimelek J', 'Andry K', 'Yulius R']; 
        const CHECKER_LIST = ['Indra R', 'Jemmie P', 'Ikram', 'Fahri T', 'Indra A', 'Andhy S', 'Agus', 'Angga', 'Henderi A', 'L Fauzan N', 'Nanda P']; 
        
        const formatter = new Intl.NumberFormat('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
        const MAX_SHIFT_MINUTES = 12 * 60; // 720 minutes

        // --- DOM ELEMENTS (Global references) ---
        const tabContents = document.querySelectorAll('.tab-content');
        const currentSDName = document.getElementById('currentSDName');
        const sdNames = ['SD1', 'SD2', 'SD3']; 

        // --- FUNGSI UTILITY ---
        function showMessage(title, content) {
            const messageBox = document.getElementById('messageBox');
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').textContent = content;
            messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('messageBox').classList.add('hidden');
        }

        function minutesToTime(totalMinutes) {
            const sign = totalMinutes < 0 ? '-' : '';
            totalMinutes = Math.abs(totalMinutes);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            return `${sign}${String(hours).padStart(1, '0')} Jam ${String(minutes).padStart(2, '0')} Menit`;
        }
        
        const getReportValue = (elementId, numeric = true) => {
            const el = document.getElementById(elementId);
            if (!el) return '-';

            const val = el.value.trim();
            if (val === '') {
                return '-';
            }
            if (el.tagName === 'SELECT' && !numeric) {
                 return val;
            }
            return numeric ? (parseFloat(val) || 0) : val;
        };
        
        function formatDateForReport(dateString) {
            if (!dateString || dateString === '-') return '-';
            const [year, month, day] = dateString.split('-');
            const shortYear = year.slice(-2);
            const monthNames = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
            const monthIndex = parseInt(month, 10) - 1;
            return `${day}/${monthNames[monthIndex].substring(0, 3)}/${shortYear}`;
        }

        // --- FUNGSI TAB INTERFACE ---
        function showTab(sdName) {
            activeSD = sdName;
            // Update teks tombol jika ada (opsional, krn tombol skrg generik)
            tabContents.forEach(content => content.classList.add('hidden'));
            document.getElementById(`${sdName}-content`).classList.remove('hidden');
            calculateAllTotals();
        }

        // --- FUNGSI PERHITUNGAN CONVEYOR ---
        function calculateDuration(sdName, index) {
            const data = entryData[sdName][index];
            if (!data) return 0;

            // Jika data jam kosong (belum diisi), return 0
            if (data.startHour === null || data.finishHour === null) return 0;

            let startMinutes = data.startHour * 60 + data.startMinute;
            let finishMinutes = data.finishHour * 60 + data.finishMinute;
            
            // Penanganan Lintasan Tengah Malam (Jika selesai lebih kecil dari mulai, dianggap besoknya)
            if (finishMinutes < startMinutes) {
                finishMinutes += 1440; 
            }

            const durationMinutes = finishMinutes - startMinutes;
            
            const durationDisplay = document.getElementById(`duration-${sdName}-${index}`);
            const durationMobileDisplay = document.getElementById(`duration-mobile-${sdName}-${index}`);
            
            if (durationMinutes < 0) {
                const errorStr = 'ERR';
                durationDisplay.textContent = errorStr;
                durationMobileDisplay.textContent = errorStr;
                return 0;
            }

            const durationStr = minutesToTime(durationMinutes).replace(' Jam', ':').replace(' Menit', '');
            durationDisplay.textContent = durationStr;
            durationMobileDisplay.textContent = durationStr;
            
            return durationMinutes;
        }

        function calculateAllTotals() {
            let totalSD1 = 0;
            let totalSD2 = 0;
            let totalSD3 = 0;

            entryData.SD1.forEach((data, index) => { totalSD1 += calculateDuration('SD1', index); });
            entryData.SD2.forEach((data, index) => { totalSD2 += calculateDuration('SD2', index); });
            entryData.SD3.forEach((data, index) => { totalSD3 += calculateDuration('SD3', index); });

            updateResultDisplay('SD1', totalSD1);
            updateResultDisplay('SD2', totalSD2);
            updateResultDisplay('SD3', totalSD3);
        }

        function updateResultDisplay(sdName, totalMinutes) {
            const totalDisplay = document.getElementById(`totalDisplay-${sdName}`);
            const remainingDisplay = document.getElementById(`remainingDisplay-${sdName}`);
            
            const totalHours = Math.floor(totalMinutes / 60);
            const totalMins = totalMinutes % 60;
            
            totalDisplay.innerHTML = `<span class="text-red-600">${formatter.format(totalHours)}</span> Jam <span class="text-red-600">${formatter.format(totalMins)}</span> Menit`;

            if (totalMinutes === 0) {
                remainingDisplay.innerHTML = `<span class="font-extrabold text-gray-500">-</span>`;
                const resultsEl = document.getElementById('results');
                if (resultsEl) resultsEl.dataset[`remainingText-${sdName}`] = `-`;
                return; 
            }

            let remainingMinutes = MAX_SHIFT_MINUTES - totalMinutes;
            let remainingText = '';
            let remainingColor = ''; 
            let excessTag = ''; 
            let finalMinutesForCopy = remainingMinutes; 

            if (remainingMinutes >= 0) {
                const remainingHours = Math.floor(remainingMinutes / 60);
                const remainingMins = remainingMinutes % 60;
                remainingColor = 'text-green-600';
                remainingText = `${formatter.format(remainingHours)} Jam ${String(remainingMins).padStart(2, '0')} Menit`;
            } else {
                finalMinutesForCopy = Math.abs(remainingMinutes);
                const excessHours = Math.floor(finalMinutesForCopy / 60);
                const excessMins = finalMinutesForCopy % 60;
                remainingColor = 'text-red-600';
                excessTag = ' (Kelebihan Durasi)'; 
                remainingText = `${formatter.format(excessHours)} Jam ${String(excessMins).padStart(2, '0')} Menit`;
            }

            remainingDisplay.innerHTML = `<span class="${remainingColor}">${remainingText}</span>`;
            
            const finalHours = Math.floor(finalMinutesForCopy / 60);
            const finalMins = finalMinutesForCopy % 60;
            const resultsEl = document.getElementById('results');
            if (resultsEl) resultsEl.dataset[`remainingText-${sdName}`] = `${finalHours} Jam ${String(finalMins).padStart(2, '0')} Menit${excessTag}`;
        }

        // --- FUNGSI MANIPULASI DOM (INPUT MANUAL) ---

        function updateEntryData(sdName, entryIndex) {
            // Mengambil value dari input type="time" (Format "HH:MM")
            const startTimeStr = document.getElementById(`startTime-${sdName}-${entryIndex}`).value;
            const finishTimeStr = document.getElementById(`finishTime-${sdName}-${entryIndex}`).value;
            
            // Parsing Waktu Mulai
            let startHour = 0, startMinute = 0;
            if (startTimeStr) {
                const parts = startTimeStr.split(':');
                startHour = parseInt(parts[0]);
                startMinute = parseInt(parts[1]);
            } else {
                startHour = null; startMinute = null; // Tandai kosong
            }

            // Parsing Waktu Selesai
            let finishHour = 0, finishMinute = 0;
            if (finishTimeStr) {
                const parts = finishTimeStr.split(':');
                finishHour = parseInt(parts[0]);
                finishMinute = parseInt(parts[1]);
            } else {
                finishHour = null; finishMinute = null; // Tandai kosong
            }
            
            entryData[sdName][entryIndex] = {
                startHour: startHour,
                startMinute: startMinute,
                finishHour: finishHour,
                finishMinute: finishMinute
            };

            calculateAllTotals();
        }

        function addEntry(sdName) {
            const container = document.getElementById(`entriesContainer-${sdName}`);
            entryCount[sdName]++;
            const entryIndex = entryCount[sdName];
            
            // Inisialisasi data kosong
            entryData[sdName].push({ startHour: null, startMinute: null, finishHour: null, finishMinute: null });
            const dataIndex = entryData[sdName].length - 1;

            const entryDiv = document.createElement('div');
            entryDiv.id = `entry-row-${sdName}-${dataIndex}`;
            entryDiv.className = 'grid grid-cols-12 gap-2 sm:gap-4 items-center bg-gray-50 p-3 rounded-xl border border-gray-200';
            
            // HTML untuk INPUT MANUAL (type="time")
            entryDiv.innerHTML = `
                <div class="col-span-1 text-center font-bold text-gray-700 text-sm sm:text-base">${dataIndex + 1}.</div>
                
                <div class="col-span-5 sm:col-span-5 flex items-center">
                    <label class="text-sm text-gray-500 font-medium time-label mr-2">Mulai:</label>
                    <input type="time" id="startTime-${sdName}-${dataIndex}" 
                           class="w-full p-2 border border-gray-300 rounded-md text-sm font-semibold text-gray-700 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" 
                           onchange="updateEntryData('${sdName}', ${dataIndex})">
                </div>

                <div class="col-span-5 sm:col-span-4 flex items-center">
                    <label class="text-sm text-gray-500 font-medium time-label mr-2">Selesai:</label>
                    <input type="time" id="finishTime-${sdName}-${dataIndex}" 
                           class="w-full p-2 border border-gray-300 rounded-md text-sm font-semibold text-gray-700 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" 
                           onchange="updateEntryData('${sdName}', ${dataIndex})">
                </div>
                
                <div class="hidden sm:block col-span-1 text-center text-sm font-bold text-indigo-600">
                    <span id="duration-${sdName}-${dataIndex}">00:00</span>
                </div>
                
                <div class="col-span-1 text-center sm:col-span-1">
                    <button type="button" onclick="removeEntry('${sdName}', ${dataIndex})" class="text-red-500 hover:text-red-700 transition duration-150 p-1 rounded-full hover:bg-red-100">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mx-auto">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="col-span-12 sm:hidden text-xs font-semibold text-gray-700 border-t border-gray-200 pt-2 mt-2 text-center">
                    Durasi Baris: <span id="duration-mobile-${sdName}-${dataIndex}" class="font-bold text-sm text-indigo-600">00:00</span>
                </div>
            `;
            container.appendChild(entryDiv);
            entryCount[sdName] = entryData[sdName].length; 
            calculateAllTotals();
        }

        function removeEntry(sdName, indexToRemove) {
            const container = document.getElementById(`entriesContainer-${sdName}`);
            
            const entryRow = document.getElementById(`entry-row-${sdName}-${indexToRemove}`);
            if (entryRow) {
                container.removeChild(entryRow);
            }

            entryData[sdName].splice(indexToRemove, 1);
            entryCount[sdName] = entryData[sdName].length;

            const rows = container.children;
            for (let i = 0; i < rows.length; i++) {
                const oldDataIndex = parseInt(rows[i].id.split('-').pop());
                
                rows[i].id = `entry-row-${sdName}-${i}`;
                
                const numDisplay = rows[i].querySelector('.col-span-1');
                if (numDisplay) {
                    numDisplay.textContent = `${i + 1}.`;
                }

                const oldIndex = oldDataIndex;
                const newIndex = i;

                // Update ID Input Time (startTime & finishTime)
                const startInput = rows[i].querySelector(`#startTime-${sdName}-${oldIndex}`);
                if(startInput) {
                    startInput.id = `startTime-${sdName}-${newIndex}`;
                    startInput.setAttribute('onchange', `updateEntryData('${sdName}', ${newIndex})`);
                }

                const finishInput = rows[i].querySelector(`#finishTime-${sdName}-${oldIndex}`);
                if(finishInput) {
                    finishInput.id = `finishTime-${sdName}-${newIndex}`;
                    finishInput.setAttribute('onchange', `updateEntryData('${sdName}', ${newIndex})`);
                }

                rows[i].querySelector(`#duration-${sdName}-${oldIndex}`).id = `duration-${sdName}-${newIndex}`;
                rows[i].querySelector(`#duration-mobile-${sdName}-${oldIndex}`).id = `duration-mobile-${sdName}-${newIndex}`;
                
                rows[i].querySelector('button').setAttribute('onclick', `removeEntry('${sdName}', ${newIndex})`);
            }
            
            calculateAllTotals();
        }
        
        // --- FUNGSI COPY & HELPER LAINNYA ---
        
        const getHasilValue = (sectionId, shift) => {
            const id = `${sectionId}-hasil-${shift}`;
            const el = document.getElementById(id);
            if (!el || !el.textContent) return 0;
            return parseFloat(el.textContent.replace(/,/g, '')) || 0;
        };
        
        function getSupervisorDisplayValue() {
            const checkboxes = document.querySelectorAll('#spvCheckboxes input[type="checkbox"]:checked');
            const primarySpvs = Array.from(checkboxes).map(cb => cb.value);
            let allSpvs = primarySpvs;
            const spvLainnyaInput = document.getElementById('inputSupervisorLainnya');
            const spvLainnya = spvLainnyaInput ? spvLainnyaInput.value.trim() : '';
            if (spvLainnya) allSpvs.push(spvLainnya);
            return allSpvs.join(' & ');
        }

        function getForemanDisplayValue() {
            const checkboxes = document.querySelectorAll('#foremanCheckboxes input[type="checkbox"]:checked');
            const selectedForemen = Array.from(checkboxes).map(cb => cb.value);
            let allForemen = selectedForemen;
            const foremanLainnyaInput = document.getElementById('inputForemanLainnya');
            const foremanLainnya = foremanLainnyaInput ? foremanLainnyaInput.value.trim() : '';
            if (foremanLainnya) allForemen.push(foremanLainnya);
            return allForemen.join(' & ');
        }
        
        function getCheckerDisplayValue() {
            const checkboxes = document.querySelectorAll('#checkerCheckboxes input[type="checkbox"]:checked');
            const selectedCheckers = Array.from(checkboxes).map(cb => cb.value);
            let allCheckers = selectedCheckers;
            const checkerLainnyaInput = document.getElementById('inputCheckerLainnya');
            const checkerLainnya = checkerLainnyaInput ? checkerLainnyaInput.value.trim() : '';
            if (checkerLainnya) allCheckers.push(checkerLainnya);
            return allCheckers.join(' & ');
        }

        function copyDailyReportSiang() {
            let reportText = '';
            const shift = getReportValue('inputShift', false);
            const rawTanggal = getReportValue('inputTanggal', false); 
            const tanggal = rawTanggal !== '-' ? formatDateForReport(rawTanggal) : '-';
            
            const supervisorDisplay = getSupervisorDisplayValue();
            const foremanDisplay = getForemanDisplayValue(); 
            const checkerDisplay = getCheckerDisplayValue();

            const tippingRom = getReportValue('inputTippingRom');
            const transferRom = getReportValue('inputTransferRom');

            reportText += `*CHP OPERATION*\n*${shift.toUpperCase()}*\n*${tanggal}*\n\n`;
            reportText += `Supervisor : ${supervisorDisplay}\nForeman   : ${foremanDisplay}\nChecker      : ${checkerDisplay}\n\n`; 
            
            const resultsDiv = document.getElementById('results');
            reportText += `Efektivitas Running\n`;
            sdNames.forEach(sdName => {
                const resultText = resultsDiv.dataset[`remainingText-${sdName}`] || '-'; 
                const finalResult = resultText === '-' ? '-' : resultText.replace(' (Kelebihan Durasi)', '');
                reportText += `- ${sdName} = ${finalResult}\n`;
            });
            reportText += `\n`;

            const mhaTrip = parseFloat(document.getElementById('mha-trip-siang').value) || 0;
            const karuniaTrip = parseFloat(document.getElementById('karunia-trip-siang').value) || 0;
            const bumaTrip = parseFloat(document.getElementById('buma-trip-siang').value) || 0;
            const kaiTrip = karuniaTrip; 
            const bTrip = bumaTrip; 
            const ipTrip = 0; 
            const totalHauling = mhaTrip + kaiTrip + bTrip + ipTrip;

            reportText += `Hauling\nMHA    : ${mhaTrip} TRIP\nBUMA   : ${bTrip} TRIP\nKAI    : ${kaiTrip} TRIP\nIP     : ${ipTrip} TRIP\nTotal Hauling : ${totalHauling} Trip\n\n`;
            
            reportText += `TIPPING ROM        = ${tippingRom}${tippingRom !== '-' ? ' Trip' : ''}\n`;
            reportText += `TRANSFER ROM   = ${transferRom}${transferRom !== '-' ? ' Trip' : ''}\n\n`;

            const mhaUnit = getHasilValue('mha', 'siang');
            const bumaUnit = getHasilValue('buma', 'siang');
            const karuniaUnit = getHasilValue('karunia', 'siang'); 
            
            reportText += `Unit 2 Trip\n- MHA   = ${mhaUnit} Unit\n- BUMA  = ${bumaUnit} Unit\n- KAI   = ${karuniaUnit} Unit\n`;

            copyToClipboard(reportText, 'Laporan Harian (Siang)');
        }
        
        function copyDailyReportMalam() {
            let reportText = '';
            const shift = getReportValue('inputShift', false);
            const rawTanggal = getReportValue('inputTanggal', false); 
            const tanggal = rawTanggal !== '-' ? formatDateForReport(rawTanggal) : '-'; 
            
            const supervisorDisplay = getSupervisorDisplayValue();
            const foremanDisplay = getForemanDisplayValue();
            const checkerDisplay = getCheckerDisplayValue();

            const tippingRom = getReportValue('inputTippingRom');
            const transferRom = getReportValue('inputTransferRom');

            reportText += `*CHP OPERATION*\n*${shift.toUpperCase()}*\n*${tanggal}*\n\n`;
            reportText += `Supervisor : ${supervisorDisplay}\nForeman   : ${foremanDisplay}\nChecker      : ${checkerDisplay}\n\n`;

            const mhaTripSiang = parseFloat(document.getElementById('mha-trip-siang').value) || 0;
            const karuniaTripSiang = parseFloat(document.getElementById('karunia-trip-siang').value) || 0;
            const bumaTripSiang = parseFloat(document.getElementById('buma-trip-siang').value) || 0;
            const mhaTripMalam = parseFloat(document.getElementById('mha-trip-malam').value) || 0;
            const karuniaTripMalam = parseFloat(document.getElementById('karunia-trip-malam').value) || 0;
            const bumaTripMalam = parseFloat(document.getElementById('buma-trip-malam').value) || 0;

            const resultsDiv = document.getElementById('results');
            reportText += `Efektivitas Running\n`;
            sdNames.forEach(sdName => {
                const resultText = resultsDiv.dataset[`remainingText-${sdName}`] || '-'; 
                const finalResult = resultText === '-' ? '-' : resultText.replace(' (Kelebihan Durasi)', '');
                reportText += `- ${sdName} = ${finalResult}\n`;
            });
            reportText += `\n`;

            const mhaTripSelisih = mhaTripMalam - mhaTripSiang;
            const karuniaTripSelisih = karuniaTripMalam - karuniaTripSiang;
            const bumaTripSelisih = bumaTripMalam - bumaTripSiang;
            
            const kaiTrip = karuniaTripSelisih; 
            const bTrip = bumaTripSelisih; 
            const ipTrip = 0; 
            const totalHauling = mhaTripSelisih + kaiTrip + bTrip + ipTrip; 

            reportText += `Hauling\nMHA    : ${mhaTripSelisih} TRIP\nBUMA   : ${bTrip} TRIP\nKAI    : ${kaiTrip} TRIP\nIP     : ${ipTrip} TRIP\nTotal Hauling : ${totalHauling} Trip\n\n`;

            reportText += `TIPPING ROM        = ${tippingRom}${tippingRom !== '-' ? ' Trip' : ''}\n`;
            reportText += `TRANSFER ROM   = ${transferRom}${transferRom !== '-' ? ' Trip' : ''}\n\n`;

            const mhaUnit = getHasilValue('mha', 'malam');
            const bumaUnit = getHasilValue('buma', 'malam');
            const karuniaUnit = getHasilValue('karunia', 'malam'); 
            
            reportText += `Unit 2 Trip\n- MHA   = ${mhaUnit} Unit\n- BUMA  = ${bumaUnit} Unit\n- KAI   = ${karuniaUnit} Unit\n`;

            copyToClipboard(reportText, 'Laporan Harian (Malam)');
        }

        function copyToClipboard(text, successMessageTitle) {
            const tempInput = document.createElement('textarea');
            tempInput.value = text.trim(); 
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                showMessage('Berhasil Disalin!', `${successMessageTitle} telah disalin ke clipboard.`);
            } catch (err) {
                showMessage('Gagal Menyalin', 'Gagal menyalin teks. Silakan salin secara manual.');
            } finally {
                document.body.removeChild(tempInput);
            }
        }

        function initUnitCalculations() {
            ['mha', 'karunia', 'buma'].forEach(id => calculateUnitResult(id));
            calculateGrandTotalUnits(); 
        }

        function populateCheckboxGroup(containerId, listData, idPrefix) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 
            listData.forEach(name => {
                const id = `${idPrefix}-${name.replace(/\s/g, '-')}`;
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type="checkbox" id="${id}" value="${name}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="${id}" class="ml-2 text-sm font-semibold text-gray-800">${name}</label>
                `;
                container.appendChild(div);
            });
        }

        window.onload = function() {
            const sdSelector = document.getElementById('sdSelector');
            sdSelector.value = 'SD1'; 
            showTab('SD1');
            
            addEntry('SD1');
            addEntry('SD1');
            addEntry('SD2');
            addEntry('SD3');

            populateCheckboxGroup('spvCheckboxes', SPV_LIST, 'spv-cb');
            populateCheckboxGroup('foremanCheckboxes', FOREMAN_LIST, 'foreman-cb');
            populateCheckboxGroup('checkerCheckboxes', CHECKER_LIST, 'checker-cb');
            
            initUnitCalculations();
            
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('inputTanggal').value = `${yyyy}-${mm}-${dd}`;
        };

        function calculateGrandTotalUnits() {
            const sections = ['mha', 'karunia', 'buma'];
            let grandTotalTripSiang = 0;
            let grandTotalTripMalam = 0;
            sections.forEach(sectionId => {
                grandTotalTripSiang += parseFloat(document.getElementById(`${sectionId}-trip-siang`).value) || 0;
                grandTotalTripMalam += parseFloat(document.getElementById(`${sectionId}-trip-malam`).value) || 0;
            });
            const tripDifference = grandTotalTripMalam - grandTotalTripSiang;

            document.getElementById('grand-total-trip-siang').textContent = formatter.format(grandTotalTripSiang);
            document.getElementById('grand-total-trip-malam').textContent = formatter.format(grandTotalTripMalam);
            document.getElementById('grand-total-trip-difference').textContent = formatter.format(tripDifference);
        }

        function calculateUnitResult(sectionId) {
            const runningSiang = parseFloat(document.getElementById(`${sectionId}-running-siang`).value) || 0;
            const tripSiang = parseFloat(document.getElementById(`${sectionId}-trip-siang`).value) || 0;
            const runningMalam = parseFloat(document.getElementById(`${sectionId}-running-malam`).value) || 0;
            const tripMalam = parseFloat(document.getElementById(`${sectionId}-trip-malam`).value) || 0;

            const hasilSiang = tripSiang - runningSiang;
            const tripDifference = tripMalam - tripSiang;
            const hasilMalam = tripDifference - runningMalam;
            
            const hasilSiangEl = document.getElementById(`${sectionId}-hasil-siang`);
            const hasilMalamEl = document.getElementById(`${sectionId}-hasil-malam`);
            const tripSelisihInlineEl = document.getElementById(`${sectionId}-trip-selisih-inline`); 

            if (hasilSiangEl) hasilSiangEl.textContent = formatter.format(hasilSiang);
            if (hasilMalamEl) hasilMalamEl.textContent = formatter.format(hasilMalam);
            if (tripSelisihInlineEl) tripSelisihInlineEl.textContent = formatter.format(tripDifference);
            
            calculateGrandTotalUnits(); 
        }
    </script>
</body>
</html>
