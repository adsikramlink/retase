<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efektivitas Running - Dashboard Modern v2.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate-100 */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Modern Input Styling */
        .modern-input {
            width: 100%;
            padding: 10px 16px;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            color: #334155;
            font-weight: 600;
            transition: all 0.2s;
            outline: none;
        }
        .modern-input:focus {
            background-color: #ffffff;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .unit-input {
            text-align: right;
            font-weight: 800;
            color: #1e293b;
        }

        /* Chip Checkbox Style */
        .chip-checkbox input:checked + div {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
        }
        .chip-checkbox div {
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
            border: 1px solid #cbd5e1;
            background-color: white;
            color: #64748b;
        }
        .chip-checkbox:hover div {
            background-color: #f1f5f9;
        }

        /* Tab Animation */
        .tab-btn {
            transition: all 0.2s ease-in-out;
        }
        .tab-btn.active {
            background-color: white;
            color: #1e293b;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="text-slate-800 pb-20">

    <!-- Header Mewah -->
    <div class="bg-slate-900 text-white pb-24 pt-10 px-4 sm:px-8 shadow-xl">
        <div class="max-w-5xl mx-auto flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-extrabold tracking-tight">Efektivitas Running</h1>
                <p class="text-slate-400 mt-2 font-medium">Dashboard Operasional & Unit Running</p>
            </div>
            <span class="bg-white/10 px-3 py-1 rounded-full text-xs border border-white/20">v2.2 Updated</span>
        </div>
    </div>

    <!-- Container Utama -->
    <div class="max-w-5xl mx-auto px-4 sm:px-8 -mt-16 space-y-8">
        
        <!-- SECTION 0: DATA OPERASI (CARD) -->
        <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-3">
                <div class="w-1.5 h-6 bg-indigo-500 rounded-full"></div>
                <h2 class="text-lg font-bold text-slate-800">0. Data Operasional</h2>
            </div>
            
            <div class="p-6 sm:p-8 space-y-6">
                <!-- Shift & Tanggal -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Shift Kerja</label>
                        <select id="inputShift" class="modern-input cursor-pointer">
                            <option value="NIGHT SHIFT">üåô NIGHT SHIFT</option>
                            <option value="DAY SHIFT">‚òÄÔ∏è DAY SHIFT</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Tanggal</label>
                        <input type="date" id="inputTanggal" class="modern-input cursor-pointer">
                    </div>
                </div>

                <!-- Personel (Chips) -->
                <div class="space-y-5">
                    <!-- Supervisor -->
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Supervisor</label>
                        <div id="spvCheckboxes" class="flex flex-wrap gap-2"></div>
                        <input type="text" id="inputSupervisorLainnya" placeholder="+ Manual (Opsional)" class="mt-2 text-sm w-full border-b border-gray-300 py-1 focus:border-indigo-500 focus:outline-none bg-transparent placeholder-gray-400">
                    </div>

                    <!-- Foreman -->
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Foreman</label>
                        <div id="foremanCheckboxes" class="flex flex-wrap gap-2"></div>
                        <input type="text" id="inputForemanLainnya" placeholder="+ Manual (Opsional)" class="mt-2 text-sm w-full border-b border-gray-300 py-1 focus:border-indigo-500 focus:outline-none bg-transparent placeholder-gray-400">
                    </div>

                    <!-- Checker -->
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Checker</label>
                        <div id="checkerCheckboxes" class="flex flex-wrap gap-2"></div>
                        <input type="text" id="inputCheckerLainnya" placeholder="+ Manual (Opsional)" class="mt-2 text-sm w-full border-b border-gray-300 py-1 focus:border-indigo-500 focus:outline-none bg-transparent placeholder-gray-400">
                    </div>
                </div>

                <!-- ROM Data -->
                <div class="grid grid-cols-2 gap-4 sm:gap-6 pt-4 border-t border-dashed border-slate-200">
                    <div class="bg-blue-50/50 p-4 rounded-xl border border-blue-100 hover:border-blue-300 transition-colors">
                        <label class="text-xs font-bold text-blue-600 uppercase mb-1 block">Tipping ROM</label>
                        <div class="flex items-baseline">
                            <input type="number" id="inputTippingRom" min="0" placeholder="0" class="bg-transparent text-2xl font-black text-blue-900 w-full outline-none placeholder-blue-200">
                            <span class="text-xs font-bold text-blue-400 ml-1">TRIP</span>
                        </div>
                    </div>
                    <div class="bg-emerald-50/50 p-4 rounded-xl border border-emerald-100 hover:border-emerald-300 transition-colors">
                        <label class="text-xs font-bold text-emerald-600 uppercase mb-1 block">Transfer ROM</label>
                        <div class="flex items-baseline">
                            <input type="number" id="inputTransferRom" min="0" placeholder="0" class="bg-transparent text-2xl font-black text-emerald-900 w-full outline-none placeholder-emerald-200">
                            <span class="text-xs font-bold text-emerald-400 ml-1">TRIP</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 1: DURASI CONVEYOR (CARD) -->
        <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex flex-wrap justify-between items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-1.5 h-6 bg-orange-500 rounded-full"></div>
                    <div>
                        <h2 class="text-lg font-bold text-slate-800 leading-tight">1. Durasi Conveyor</h2>
                        <!-- TEKS BARU DITAMBAHKAN DI SINI -->
                        <p class="text-xs text-slate-500 font-medium">Hitung Waktu Indikasi</p>
                    </div>
                </div>
                
                <!-- Modern Tab Switcher -->
                <div class="flex bg-slate-200 p-1 rounded-lg">
                    <button onclick="switchTabModern('SD1')" id="tab-btn-SD1" class="tab-btn px-6 py-1.5 rounded-md text-sm font-bold text-slate-500 active">SD1</button>
                    <button onclick="switchTabModern('SD2')" id="tab-btn-SD2" class="tab-btn px-6 py-1.5 rounded-md text-sm font-bold text-slate-500">SD2</button>
                    <button onclick="switchTabModern('SD3')" id="tab-btn-SD3" class="tab-btn px-6 py-1.5 rounded-md text-sm font-bold text-slate-500">SD3</button>
                </div>
                <select id="sdSelector" onchange="showTab(this.value)" class="hidden"><option value="SD1">SD1</option><option value="SD2">SD2</option><option value="SD3">SD3</option></select>
            </div>

            <div class="p-4 sm:p-6 bg-slate-50/30 min-h-[300px]">
                <div id="tab-content-container">
                    <!-- Column Headers -->
                    <div class="hidden sm:grid grid-cols-12 gap-4 text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 px-3">
                        <div class="col-span-1 text-center">#</div>
                        <div class="col-span-5">Waktu Mulai</div>
                        <div class="col-span-4">Waktu Selesai</div>
                        <div class="col-span-1 text-center">Durasi</div>
                        <div class="col-span-1"></div>
                    </div>

                    <!-- Containers -->
                    <div id="SD1-content" class="tab-content space-y-3">
                        <div id="entriesContainer-SD1" class="space-y-3"></div>
                    </div>
                    <div id="SD2-content" class="tab-content hidden space-y-3">
                        <div id="entriesContainer-SD2" class="space-y-3"></div>
                    </div>
                    <div id="SD3-content" class="tab-content hidden space-y-3">
                        <div id="entriesContainer-SD3" class="space-y-3"></div>
                    </div>

                    <button type="button" onclick="addEntry(activeSD)" class="mt-6 w-full py-3 border-2 border-dashed border-indigo-300 text-indigo-600 font-bold rounded-xl hover:bg-indigo-50 hover:border-indigo-400 transition-all flex items-center justify-center gap-2 group">
                        <svg class="w-5 h-5 transform group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        Tambah Baris Waktu
                    </button>
                </div>
            </div>

            <!-- Result Cards (Footer) -->
            <div id="results" class="bg-white px-6 py-6 border-t border-slate-100">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Ringkasan Efektivitas</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- SD1 -->
                    <div class="bg-gradient-to-br from-slate-50 to-white p-5 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-blue-100 rounded-bl-full -mr-10 -mt-10 opacity-50 transition-transform group-hover:scale-110"></div>
                        <h4 class="text-lg font-black text-slate-700">SD1</h4>
                        <div class="flex justify-between items-end mt-4">
                            <div>
                                <!-- GANTI LABEL: Total Running -> Indikasi -->
                                <div class="text-[10px] uppercase font-bold text-slate-400">Indikasi</div>
                                <div id="totalDisplay-SD1" class="text-xl font-bold text-slate-800">0j 0m</div>
                            </div>
                            <div class="text-right z-10">
                                <!-- GANTI LABEL: Sisa Waktu -> Efektivitas Running -->
                                <div class="text-[10px] uppercase font-bold text-slate-400">Efektivitas Running</div>
                                <div id="remainingDisplay-SD1" class="text-xl font-bold text-emerald-600">12j 0m</div>
                            </div>
                        </div>
                    </div>
                    <!-- SD2 -->
                    <div class="bg-gradient-to-br from-slate-50 to-white p-5 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-purple-100 rounded-bl-full -mr-10 -mt-10 opacity-50 transition-transform group-hover:scale-110"></div>
                        <h4 class="text-lg font-black text-slate-700">SD2</h4>
                        <div class="flex justify-between items-end mt-4">
                            <div>
                                <div class="text-[10px] uppercase font-bold text-slate-400">Indikasi</div>
                                <div id="totalDisplay-SD2" class="text-xl font-bold text-slate-800">0j 0m</div>
                            </div>
                            <div class="text-right z-10">
                                <div class="text-[10px] uppercase font-bold text-slate-400">Efektivitas Running</div>
                                <div id="remainingDisplay-SD2" class="text-xl font-bold text-emerald-600">12j 0m</div>
                            </div>
                        </div>
                    </div>
                    <!-- SD3 -->
                    <div class="bg-gradient-to-br from-slate-50 to-white p-5 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-pink-100 rounded-bl-full -mr-10 -mt-10 opacity-50 transition-transform group-hover:scale-110"></div>
                        <h4 class="text-lg font-black text-slate-700">SD3</h4>
                        <div class="flex justify-between items-end mt-4">
                            <div>
                                <div class="text-[10px] uppercase font-bold text-slate-400">Indikasi</div>
                                <div id="totalDisplay-SD3" class="text-xl font-bold text-slate-800">0j 0m</div>
                            </div>
                            <div class="text-right z-10">
                                <div class="text-[10px] uppercase font-bold text-slate-400">Efektivitas Running</div>
                                <div id="remainingDisplay-SD3" class="text-xl font-bold text-emerald-600">12j 0m</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: UNIT RUNNING (CARD) -->
        <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden mb-12">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-3">
                <div class="w-1.5 h-6 bg-emerald-500 rounded-full"></div>
                <h2 class="text-lg font-bold text-slate-800">2. Perhitungan Unit Running</h2>
            </div>

            <div class="p-6 sm:p-8 space-y-8">
                
                <!-- MHA -->
                <div id="mha-section" class="relative pl-4 sm:pl-0">
                    <div class="absolute left-0 top-0 bottom-0 w-1.5 bg-orange-400 rounded-r-lg sm:hidden"></div>
                    <div class="flex items-center gap-3 mb-4">
                        <div class="hidden sm:block w-3 h-3 rounded-full bg-orange-500 shadow-lg shadow-orange-200"></div>
                        <h3 class="text-xl font-black text-slate-800">MHA</h3>
                        <span class="text-[10px] font-bold bg-orange-100 text-orange-700 px-2 py-0.5 rounded border border-orange-200 tracking-wide uppercase">Contractor 01</span>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 bg-orange-50/40 p-5 rounded-2xl border border-orange-100 hover:border-orange-200 transition-colors">
                        <!-- Siang -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-orange-200 pb-2 mb-2">Shift Siang ‚òÄÔ∏è</h4>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Unit Running</label>
                                <input type="number" id="mha-running-siang" min="0" oninput="calculateUnitResult('mha')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Trip Unit</label>
                                <input type="number" id="mha-trip-siang" min="0" oninput="calculateUnitResult('mha')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between pt-3 border-t border-dashed border-orange-200">
                                <span class="text-sm font-bold text-orange-900">Hasil (2 Trip)</span>
                                <span id="mha-hasil-siang" class="text-2xl font-black text-slate-800">0</span>
                            </div>
                        </div>
                        
                        <!-- Malam -->
                        <div class="space-y-4 lg:border-l lg:border-orange-200 lg:pl-6">
                            <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-orange-200 pb-2 mb-2">Shift Malam üåô</h4>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Unit Running</label>
                                <input type="number" id="mha-running-malam" min="0" oninput="calculateUnitResult('mha')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Trip Unit</label>
                                <input type="number" id="mha-trip-malam" min="0" oninput="calculateUnitResult('mha')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between pt-3 border-t border-dashed border-orange-200">
                                <div class="flex flex-col">
                                    <span class="text-sm font-bold text-orange-900">Hasil (2 Trip)</span>
                                    <span class="text-[10px] text-slate-400 font-medium">Selisih Trip: <span id="mha-trip-selisih-inline" class="font-bold">0</span></span>
                                </div>
                                <span id="mha-hasil-malam" class="text-2xl font-black text-slate-800">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KARUNIA -->
                <div id="karunia-section" class="relative pl-4 sm:pl-0">
                    <div class="absolute left-0 top-0 bottom-0 w-1.5 bg-emerald-400 rounded-r-lg sm:hidden"></div>
                    <div class="flex items-center gap-3 mb-4">
                        <div class="hidden sm:block w-3 h-3 rounded-full bg-emerald-500 shadow-lg shadow-emerald-200"></div>
                        <h3 class="text-xl font-black text-slate-800">KARUNIA</h3>
                        <span class="text-[10px] font-bold bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded border border-emerald-200 tracking-wide uppercase">Contractor 02</span>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 bg-emerald-50/40 p-5 rounded-2xl border border-emerald-100 hover:border-emerald-200 transition-colors">
                        <!-- Siang -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-emerald-200 pb-2 mb-2">Shift Siang ‚òÄÔ∏è</h4>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Unit Running</label>
                                <input type="number" id="karunia-running-siang" min="0" oninput="calculateUnitResult('karunia')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Trip Unit</label>
                                <input type="number" id="karunia-trip-siang" min="0" oninput="calculateUnitResult('karunia')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between pt-3 border-t border-dashed border-emerald-200">
                                <span class="text-sm font-bold text-emerald-900">Hasil (2 Trip)</span>
                                <span id="karunia-hasil-siang" class="text-2xl font-black text-slate-800">0</span>
                            </div>
                        </div>
                        <!-- Malam -->
                        <div class="space-y-4 lg:border-l lg:border-emerald-200 lg:pl-6">
                            <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-emerald-200 pb-2 mb-2">Shift Malam üåô</h4>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Unit Running</label>
                                <input type="number" id="karunia-running-malam" min="0" oninput="calculateUnitResult('karunia')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Trip Unit</label>
                                <input type="number" id="karunia-trip-malam" min="0" oninput="calculateUnitResult('karunia')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between pt-3 border-t border-dashed border-emerald-200">
                                <div class="flex flex-col">
                                    <span class="text-sm font-bold text-emerald-900">Hasil (2 Trip)</span>
                                    <span class="text-[10px] text-slate-400 font-medium">Selisih Trip: <span id="karunia-trip-selisih-inline" class="font-bold">0</span></span>
                                </div>
                                <span id="karunia-hasil-malam" class="text-2xl font-black text-slate-800">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BUMA -->
                <div id="buma-section" class="relative pl-4 sm:pl-0">
                    <div class="absolute left-0 top-0 bottom-0 w-1.5 bg-yellow-400 rounded-r-lg sm:hidden"></div>
                    <div class="flex items-center gap-3 mb-4">
                        <div class="hidden sm:block w-3 h-3 rounded-full bg-yellow-400 shadow-lg shadow-yellow-200"></div>
                        <h3 class="text-xl font-black text-slate-800">BUMA</h3>
                        <span class="text-[10px] font-bold bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded border border-yellow-200 tracking-wide uppercase">Contractor 03</span>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 bg-yellow-50/50 p-5 rounded-2xl border border-yellow-100 hover:border-yellow-200 transition-colors">
                        <!-- Siang -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-yellow-200 pb-2 mb-2">Shift Siang ‚òÄÔ∏è</h4>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Unit Running</label>
                                <input type="number" id="buma-running-siang" min="0" oninput="calculateUnitResult('buma')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Trip Unit</label>
                                <input type="number" id="buma-trip-siang" min="0" oninput="calculateUnitResult('buma')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between pt-3 border-t border-dashed border-yellow-200">
                                <span class="text-sm font-bold text-yellow-900">Hasil (2 Trip)</span>
                                <span id="buma-hasil-siang" class="text-2xl font-black text-slate-800">0</span>
                            </div>
                        </div>
                        <!-- Malam -->
                        <div class="space-y-4 lg:border-l lg:border-yellow-200 lg:pl-6">
                            <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-yellow-200 pb-2 mb-2">Shift Malam üåô</h4>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Unit Running</label>
                                <input type="number" id="buma-running-malam" min="0" oninput="calculateUnitResult('buma')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-semibold text-slate-600">Trip Unit</label>
                                <input type="number" id="buma-trip-malam" min="0" oninput="calculateUnitResult('buma')" class="modern-input w-28 unit-input h-10">
                            </div>
                            <div class="flex items-center justify-between pt-3 border-t border-dashed border-yellow-200">
                                <div class="flex flex-col">
                                    <span class="text-sm font-bold text-yellow-900">Hasil (2 Trip)</span>
                                    <span class="text-[10px] text-slate-400 font-medium">Selisih Trip: <span id="buma-trip-selisih-inline" class="font-bold">0</span></span>
                                </div>
                                <span id="buma-hasil-malam" class="text-2xl font-black text-slate-800">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grand Total Section -->
            <div class="bg-indigo-900 text-white p-6 border-t border-indigo-800">
                <h3 class="text-xs font-bold text-indigo-300 uppercase tracking-widest mb-4">Total Akumulasi Trip Hauling</h3>
                <div class="grid grid-cols-3 gap-2 sm:gap-4 text-center divide-x divide-indigo-800/50">
                    <div>
                        <div class="text-[10px] sm:text-xs text-indigo-300 mb-1 uppercase">Total Siang</div>
                        <div id="grand-total-trip-siang" class="text-xl sm:text-2xl font-bold">0</div>
                    </div>
                    <div>
                        <div class="text-[10px] sm:text-xs text-indigo-300 mb-1 uppercase">Total Malam</div>
                        <div id="grand-total-trip-malam" class="text-xl sm:text-2xl font-bold">0</div>
                    </div>
                    <div>
                        <div class="text-[10px] sm:text-xs text-indigo-300 mb-1 uppercase">Selisih (M-S)</div>
                        <div id="grand-total-trip-difference" class="text-xl sm:text-2xl font-bold text-yellow-400">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTIONS BUTTONS -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-12">
            <button type="button" onclick="copyDailyReportSiang()" class="group relative bg-white overflow-hidden rounded-2xl shadow-lg border border-purple-100 p-6 text-left transition-all hover:shadow-xl hover:-translate-y-1 active:scale-95">
                <div class="absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                <h3 class="text-lg font-black text-purple-700 relative z-10">Salin Laporan SIANG</h3>
                <p class="text-sm text-slate-500 mt-1 relative z-10">Format WhatsApp otomatis.</p>
                <div class="mt-4 flex items-center text-purple-600 font-bold text-sm relative z-10">
                    Salin Sekarang 
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                </div>
            </button>

            <button type="button" onclick="copyDailyReportMalam()" class="group relative bg-white overflow-hidden rounded-2xl shadow-lg border border-indigo-100 p-6 text-left transition-all hover:shadow-xl hover:-translate-y-1 active:scale-95">
                <div class="absolute right-0 top-0 w-24 h-24 bg-indigo-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                <h3 class="text-lg font-black text-indigo-700 relative z-10">Salin Laporan MALAM</h3>
                <p class="text-sm text-slate-500 mt-1 relative z-10">Format WhatsApp otomatis.</p>
                <div class="mt-4 flex items-center text-indigo-600 font-bold text-sm relative z-10">
                    Salin Sekarang 
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                </div>
            </button>
        </div>
    </div>

    <!-- Notification Toast (Popup Hitam di Kanan Bawah) -->
    <div id="messageBox" class="fixed bottom-6 right-6 z-50 hidden transition-all duration-300 transform translate-y-10 opacity-0">
        <div class="bg-slate-800 text-white px-5 py-3 rounded-xl shadow-2xl flex items-center gap-3 border border-slate-700">
            <div class="bg-green-500/20 p-1.5 rounded-full text-green-400">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <div>
                <h4 id="messageTitle" class="font-bold text-sm">Berhasil</h4>
                <p id="messageContent" class="text-xs text-slate-400">Teks telah disalin.</p>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & KONFIGURASI ---
        let entryCount = { SD1: 0, SD2: 0, SD3: 0 };
        const entryData = { SD1: [], SD2: [], SD3: [] };
        let activeSD = 'SD1';
        
        const SPV_LIST = ['Ihsan R', 'Dicky F', 'Sopian']; 
        const FOREMAN_LIST = ['Gunawan TC', 'Hardiansyah', 'Lewi S', 'Elimelek J', 'Andry K', 'Yulius R']; 
        const CHECKER_LIST = ['Indra R', 'Jemmie P', 'Ikram', 'Fahri T', 'Indra A', 'Andhy S', 'Agus', 'Angga', 'Henderi A', 'L Fauzan N', 'Nanda P']; 
        
        const formatter = new Intl.NumberFormat('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
        const MAX_SHIFT_MINUTES = 12 * 60; // 720 minutes
        const sdNames = ['SD1', 'SD2', 'SD3']; 

        // --- MODERN TAB SWITCHER ---
        function switchTabModern(sdName) {
            // Update Tampilan Tombol
            sdNames.forEach(name => {
                const btn = document.getElementById(`tab-btn-${name}`);
                if (name === sdName) {
                    btn.classList.add('active', 'bg-white', 'text-slate-800', 'shadow-sm');
                    btn.classList.remove('text-slate-500');
                } else {
                    btn.classList.remove('active', 'bg-white', 'text-slate-800', 'shadow-sm');
                    btn.classList.add('text-slate-500');
                }
            });
            
            // Logic Tab Lama
            document.getElementById('sdSelector').value = sdName;
            showTab(sdName);
        }

        function showTab(sdName) {
            activeSD = sdName;
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.getElementById(`${sdName}-content`).classList.remove('hidden');
            calculateAllTotals();
        }

        // --- TOAST NOTIFICATION ---
        function showMessage(title, content) {
            const box = document.getElementById('messageBox');
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').textContent = content;
            
            box.classList.remove('hidden');
            // Sedikit delay agar animasi translate berfungsi
            setTimeout(() => {
                box.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            // Hilang otomatis setelah 2.5 detik
            setTimeout(() => {
                hideMessage();
            }, 2500);
        }

        function hideMessage() {
            const box = document.getElementById('messageBox');
            box.classList.add('translate-y-10', 'opacity-0');
            setTimeout(() => {
                box.classList.add('hidden');
            }, 300);
        }

        // --- CORE CALCULATION LOGIC ---
        function minutesToTime(totalMinutes) {
            const sign = totalMinutes < 0 ? '-' : '';
            totalMinutes = Math.abs(totalMinutes);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            return `${sign}${hours}j ${minutes}m`;
        }
        
        function calculateDuration(sdName, index) {
            const data = entryData[sdName][index];
            if (!data || data.startHour === null || data.finishHour === null) return 0;

            let startMinutes = data.startHour * 60 + data.startMinute;
            let finishMinutes = data.finishHour * 60 + data.finishMinute;
            
            if (finishMinutes < startMinutes) finishMinutes += 1440; 

            const durationMinutes = finishMinutes - startMinutes;
            const displayEl = document.getElementById(`duration-${sdName}-${index}`);
            
            if (durationMinutes < 0) {
                if(displayEl) displayEl.textContent = "ERR";
                return 0;
            }

            // Format HH:MM
            const hh = Math.floor(durationMinutes/60).toString().padStart(2,'0');
            const mm = (durationMinutes%60).toString().padStart(2,'0');
            if(displayEl) displayEl.textContent = `${hh}:${mm}`;
            
            return durationMinutes;
        }

        function calculateAllTotals() {
            let totalSD1 = 0; let totalSD2 = 0; let totalSD3 = 0;
            entryData.SD1.forEach((d, i) => totalSD1 += calculateDuration('SD1', i));
            entryData.SD2.forEach((d, i) => totalSD2 += calculateDuration('SD2', i));
            entryData.SD3.forEach((d, i) => totalSD3 += calculateDuration('SD3', i));
            updateResultDisplay('SD1', totalSD1);
            updateResultDisplay('SD2', totalSD2);
            updateResultDisplay('SD3', totalSD3);
        }

        function updateResultDisplay(sdName, totalMinutes) {
            const totalDisplay = document.getElementById(`totalDisplay-${sdName}`);
            const remainingDisplay = document.getElementById(`remainingDisplay-${sdName}`);
            
            const totalHours = Math.floor(totalMinutes / 60);
            const totalMins = totalMinutes % 60;
            totalDisplay.textContent = `${totalHours}j ${totalMins}m`;

            const resultsEl = document.getElementById('results');
            
            if (totalMinutes === 0) {
                remainingDisplay.textContent = '-';
                remainingDisplay.className = "text-xl font-bold text-slate-300";
                if (resultsEl) resultsEl.dataset[`remainingText-${sdName}`] = `-`;
                return; 
            }

            let remainingMinutes = MAX_SHIFT_MINUTES - totalMinutes;
            let finalMinutesForCopy = Math.abs(remainingMinutes);
            const remH = Math.floor(finalMinutesForCopy / 60);
            const remM = finalMinutesForCopy % 60;

            if (remainingMinutes >= 0) {
                remainingDisplay.className = "text-xl font-bold text-emerald-600";
                remainingDisplay.textContent = `${remH}j ${remM}m`;
            } else {
                remainingDisplay.className = "text-xl font-bold text-red-600";
                remainingDisplay.textContent = `${remH}j ${remM}m (Over)`;
            }
            
            const excessTag = remainingMinutes < 0 ? ' (Kelebihan Durasi)' : '';
            if (resultsEl) resultsEl.dataset[`remainingText-${sdName}`] = `${remH} Jam ${String(remM).padStart(2, '0')} Menit${excessTag}`;
        }

        // --- ROW MANAGEMENT ---
        function updateEntryData(sdName, entryIndex) {
            const startStr = document.getElementById(`startTime-${sdName}-${entryIndex}`).value;
            const finishStr = document.getElementById(`finishTime-${sdName}-${entryIndex}`).value;
            
            const parseTime = (str) => {
                if(!str) return { h: null, m: null };
                const p = str.split(':');
                return { h: parseInt(p[0]), m: parseInt(p[1]) };
            };

            const s = parseTime(startStr);
            const f = parseTime(finishStr);
            
            entryData[sdName][entryIndex] = { startHour: s.h, startMinute: s.m, finishHour: f.h, finishMinute: f.m };
            calculateAllTotals();
        }

        function addEntry(sdName) {
            const container = document.getElementById(`entriesContainer-${sdName}`);
            entryCount[sdName]++;
            entryData[sdName].push({ startHour: null, startMinute: null, finishHour: null, finishMinute: null });
            const idx = entryData[sdName].length - 1;

            const div = document.createElement('div');
            div.id = `entry-row-${sdName}-${idx}`;
            div.className = 'grid grid-cols-12 gap-3 items-center bg-white p-3 rounded-xl border border-slate-200 shadow-sm transition-all hover:border-indigo-300 group';
            
            div.innerHTML = `
                <div class="col-span-1 text-center font-bold text-slate-300 text-sm entry-number">${idx + 1}</div>
                <div class="col-span-5">
                    <label class="block sm:hidden text-[10px] font-bold text-slate-400 mb-1">MULAI</label>
                    <input type="time" id="startTime-${sdName}-${idx}" 
                           class="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:border-indigo-500 outline-none" 
                           onchange="updateEntryData('${sdName}-${idx}')">
                </div>
                <div class="col-span-5 sm:col-span-4">
                    <label class="block sm:hidden text-[10px] font-bold text-slate-400 mb-1">SELESAI</label>
                    <input type="time" id="finishTime-${sdName}-${idx}" 
                           class="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:border-indigo-500 outline-none" 
                           onchange="updateEntryData('${sdName}', ${idx})">
                </div>
                <div class="hidden sm:block col-span-1 text-center text-sm font-bold text-indigo-600 bg-indigo-50 py-2 rounded-lg">
                    <span id="duration-${sdName}-${idx}">00:00</span>
                </div>
                <div class="col-span-1 text-center sm:col-span-1">
                    <button type="button" onclick="removeEntry('${sdName}', ${idx})" class="text-slate-300 hover:text-red-500 transition p-2 hover:bg-red-50 rounded-lg">
                        <svg class="w-5 h-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                </div>
            `;
            // Correction: updateEntryData call was missing params in start input string literal in previous block, fixing here via logic below
            const startInput = div.querySelector(`[id^='startTime']`);
            startInput.setAttribute('onchange', `updateEntryData('${sdName}', ${idx})`);
            
            container.appendChild(div);
            calculateAllTotals();
        }

        function removeEntry(sdName, idx) {
            const container = document.getElementById(`entriesContainer-${sdName}`);
            const row = document.getElementById(`entry-row-${sdName}-${idx}`);
            if (row) container.removeChild(row);

            entryData[sdName].splice(idx, 1);
            
            // Re-index
            Array.from(container.children).forEach((row, newIdx) => {
                row.id = `entry-row-${sdName}-${newIdx}`;
                row.querySelector('.entry-number').textContent = newIdx + 1;
                
                const start = row.querySelector(`[id^='startTime']`);
                start.id = `startTime-${sdName}-${newIdx}`;
                start.setAttribute('onchange', `updateEntryData('${sdName}', ${newIdx})`);

                const finish = row.querySelector(`[id^='finishTime']`);
                finish.id = `finishTime-${sdName}-${newIdx}`;
                finish.setAttribute('onchange', `updateEntryData('${sdName}', ${newIdx})`);

                const dur = row.querySelector(`[id^='duration-${sdName}']`);
                if(dur) dur.id = `duration-${sdName}-${newIdx}`;

                const btn = row.querySelector('button');
                btn.setAttribute('onclick', `removeEntry('${sdName}', ${newIdx})`);
            });
            calculateAllTotals();
        }

        // --- UNIT CALCULATIONS ---
        function calculateGrandTotalUnits() {
            const ids = ['mha', 'karunia', 'buma'];
            let totalS = 0, totalM = 0;
            
            ids.forEach(id => {
                totalS += parseFloat(document.getElementById(`${id}-trip-siang`).value) || 0;
                totalM += parseFloat(document.getElementById(`${id}-trip-malam`).value) || 0;
            });

            document.getElementById('grand-total-trip-siang').textContent = formatter.format(totalS);
            document.getElementById('grand-total-trip-malam').textContent = formatter.format(totalM);
            document.getElementById('grand-total-trip-difference').textContent = formatter.format(totalM - totalS);
        }

        function calculateUnitResult(id) {
            const rS = parseFloat(document.getElementById(`${id}-running-siang`).value) || 0;
            const tS = parseFloat(document.getElementById(`${id}-trip-siang`).value) || 0;
            const rM = parseFloat(document.getElementById(`${id}-running-malam`).value) || 0;
            const tM = parseFloat(document.getElementById(`${id}-trip-malam`).value) || 0;

            const hasilS = tS - rS;
            const tripDiff = tM - tS;
            const hasilM = tripDiff - rM;
            
            document.getElementById(`${id}-hasil-siang`).textContent = formatter.format(hasilS);
            document.getElementById(`${id}-hasil-malam`).textContent = formatter.format(hasilM);
            
            const diffEl = document.getElementById(`${id}-trip-selisih-inline`);
            if(diffEl) diffEl.textContent = formatter.format(tripDiff);
            
            calculateGrandTotalUnits(); 
        }

        // --- HELPER FUNCTIONS ---
        function populateCheckboxGroup(containerId, listData, idPrefix) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 
            listData.forEach(name => {
                const id = `${idPrefix}-${name.replace(/\s/g, '-')}`;
                const label = document.createElement('label');
                label.className = 'chip-checkbox';
                label.innerHTML = `
                    <input type="checkbox" id="${id}" value="${name}" class="hidden peer">
                    <div class="px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1">
                        ${name}
                        <svg class="w-3 h-3 hidden text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                `;
                container.appendChild(label);
            });
        }

        function getCheckedValues(containerId, manualInputId) {
            const checked = Array.from(document.querySelectorAll(`#${containerId} input:checked`)).map(cb => cb.value);
            const manual = document.getElementById(manualInputId).value.trim();
            if(manual) checked.push(manual);
            return checked.join(' & ');
        }

        function formatDateForReport(dateString) {
            if (!dateString) return '-';
            const [y, m, d] = dateString.split('-');
            const months = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
            return `${d}/${months[parseInt(m)-1].substring(0,3)}/${y.slice(-2)}`;
        }

        // --- COPY REPORT LOGIC ---
        function generateReport(isMalam) {
            const shift = document.getElementById('inputShift').value;
            const date = document.getElementById('inputTanggal').value;
            const spv = getCheckedValues('spvCheckboxes', 'inputSupervisorLainnya');
            const frm = getCheckedValues('foremanCheckboxes', 'inputForemanLainnya');
            const chk = getCheckedValues('checkerCheckboxes', 'inputCheckerLainnya');
            const tipping = document.getElementById('inputTippingRom').value || '-';
            const transfer = document.getElementById('inputTransferRom').value || '-';

            let text = `*CHP OPERATION*\n*${shift}*\n*${formatDateForReport(date)}*\n\n`;
            text += `Supervisor : ${spv}\nForeman   : ${frm}\nChecker      : ${chk}\n\n`;
            
            text += `Efektivitas Running\n`;
            sdNames.forEach(sd => {
                const res = document.getElementById('results').dataset[`remainingText-${sd}`] || '-';
                text += `- ${sd} = ${res.replace(' (Kelebihan Durasi)', '')}\n`;
            });
            text += `\n`;

            const mhaT = isMalam ? (parseFloat(document.getElementById('mha-trip-malam').value)||0) - (parseFloat(document.getElementById('mha-trip-siang').value)||0) : parseFloat(document.getElementById('mha-trip-siang').value)||0;
            const kaiT = isMalam ? (parseFloat(document.getElementById('karunia-trip-malam').value)||0) - (parseFloat(document.getElementById('karunia-trip-siang').value)||0) : parseFloat(document.getElementById('karunia-trip-siang').value)||0;
            const bumaT = isMalam ? (parseFloat(document.getElementById('buma-trip-malam').value)||0) - (parseFloat(document.getElementById('buma-trip-siang').value)||0) : parseFloat(document.getElementById('buma-trip-siang').value)||0;
            
            text += `Hauling\nMHA    : ${mhaT} TRIP\nBUMA   : ${bumaT} TRIP\nKAI    : ${kaiT} TRIP\nIP     : 0 TRIP\nTotal Hauling : ${mhaT+kaiT+bumaT} Trip\n\n`;
            
            text += `TIPPING ROM        = ${tipping} Trip\n`;
            text += `TRANSFER ROM   = ${transfer} Trip\n\n`;

            const suffix = isMalam ? 'malam' : 'siang';
            text += `Unit 2 Trip\n`;
            text += `- MHA   = ${document.getElementById(`mha-hasil-${suffix}`).innerText} Unit\n`;
            text += `- BUMA  = ${document.getElementById(`buma-hasil-${suffix}`).innerText} Unit\n`;
            text += `- KAI   = ${document.getElementById(`karunia-hasil-${suffix}`).innerText} Unit\n`;

            const temp = document.createElement('textarea');
            temp.value = text;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
            showMessage('Berhasil', `Laporan ${isMalam ? 'MALAM' : 'SIANG'} disalin!`);
        }

        function copyDailyReportSiang() { generateReport(false); }
        function copyDailyReportMalam() { generateReport(true); }

        // --- INIT ---
        window.onload = () => {
            switchTabModern('SD1');
            addEntry('SD1'); addEntry('SD1'); addEntry('SD2'); addEntry('SD3');
            populateCheckboxGroup('spvCheckboxes', SPV_LIST, 'spv-cb');
            populateCheckboxGroup('foremanCheckboxes', FOREMAN_LIST, 'foreman-cb');
            populateCheckboxGroup('checkerCheckboxes', CHECKER_LIST, 'checker-cb');
            initUnitCalculations = () => { ['mha', 'karunia', 'buma'].forEach(id => calculateUnitResult(id)); };
            initUnitCalculations();
            
            const now = new Date();
            document.getElementById('inputTanggal').value = now.toISOString().split('T')[0];
        };
    </script>
</body>
</html>


