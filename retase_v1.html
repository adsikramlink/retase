<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efektivitas Running</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Konfigurasi Font Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236B7280'><path fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/></svg>");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em;
            padding-right: 2.25rem;
        }
        .unit-input {
             @apply p-2 border border-gray-300 rounded-md text-right font-semibold focus:ring focus:ring-opacity-50;
        }
        /* Style untuk kolom input tambahan (Selisih Trip) agar terlihat seperti output */
        .output-display {
            @apply p-2 bg-gray-200 rounded-md text-right font-extrabold text-red-700 pointer-events-none border border-gray-400;
        }
        /* Mengatur agar input date picker terlihat rapi */
        input[type="date"]::-webkit-calendar-picker-indicator {
            padding: 0;
            margin-right: 0.25rem;
            opacity: 0.7;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl">
        <header class="mb-6">
            <h1 class="text-3xl font-extrabold text-gray-900 border-b pb-2">Efektivitas Running</h1>
            <p class="text-sm text-gray-500 mt-2">Kalkulator Durasi Conveyor dan Perhitungan Unit Running.</p>
        </header>

        <!-- Bagian BARU: Data Operasi (Input Manual) -->
        <div class="mb-12">
            <h2 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">0. Data Operasi (CHP OPERATION)</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Shift & Tanggal -->
                    <div>
                        <label for="inputShift" class="block text-sm font-medium text-gray-700">Shift:</label>
                        <select id="inputShift" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm font-semibold focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="NIGHT SHIFT">NIGHT SHIFT</option>
                            <option value="DAY SHIFT">DAY SHIFT</option>
                        </select>
                    </div>
                    <div>
                        <label for="inputTanggal" class="block text-sm font-medium text-gray-700">Tanggal:</label>
                        <input type="date" id="inputTanggal" value="2025-10-18" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm font-semibold focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <!-- Personel -->
                <div class="space-y-3">
                    <!-- Supervisor Checkbox dan Lainnya -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Supervisor (Pilih 1 atau lebih):</label>
                        <div id="spvCheckboxes" class="flex flex-wrap gap-x-4 gap-y-1 mt-1 p-2 border border-gray-300 rounded-md bg-gray-50">
                            <!-- Checkboxes akan dipopulasi oleh JS -->
                        </div>
                    </div>
                    <div class="w-full">
                        <label for="inputSupervisorLainnya" class="block text-sm font-medium text-gray-700">Supervisor Lainnya (Opsional):</label>
                        <input type="text" id="inputSupervisorLainnya" placeholder="Cth: Rudi B & Jono S" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>

                    <!-- Foreman Checkbox dan Lainnya -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Foreman (Pilih 1 atau lebih):</label>
                        <div id="foremanCheckboxes" class="flex flex-wrap gap-x-4 gap-y-1 mt-1 p-2 border border-gray-300 rounded-md bg-gray-50">
                            <!-- Checkboxes akan dipopulasi oleh JS -->
                        </div>
                    </div>
                    <div class="w-full">
                        <label for="inputForemanLainnya" class="block text-sm font-medium text-gray-700">Foreman Lainnya (Opsional):</label>
                        <input type="text" id="inputForemanLainnya" placeholder="Cth: Dedi S & Agus P" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>

                    <!-- Checker Checkbox dan Lainnya -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Checker (Pilih 1 atau lebih):</label>
                        <div id="checkerCheckboxes" class="flex flex-wrap gap-x-4 gap-y-1 mt-1 p-2 border border-gray-300 rounded-md bg-gray-50">
                            <!-- Checkboxes akan dipopulasi oleh JS -->
                        </div>
                    </div>
                    <div class="w-full">
                        <label for="inputCheckerLainnya" class="block text-sm font-medium text-gray-700">Checker Lainnya (Opsional):</label>
                        <input type="text" id="inputCheckerLainnya" placeholder="Cth: Iwan A & Dani B" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>

                <!-- Tipping & Transfer ROM -->
                <div class="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200">
                    <div>
                        <label for="inputTippingRom" class="block text-sm font-medium text-gray-700">TIPPING ROM (Trip):</label>
                        <!-- Menghapus value="10" agar bisa diisi "-" saat kosong -->
                        <input type="number" id="inputTippingRom" placeholder="Cth: 10" min="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm text-right font-semibold">
                    </div>
                    <div>
                        <label for="inputTransferRom" class="block text-sm font-medium text-gray-700">TRANSFER ROM (Trip):</label>
                        <!-- Menghapus value="12" agar bisa diisi "-" saat kosong -->
                        <input type="number" id="inputTransferRom" placeholder="Cth: 12" min="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm text-right font-semibold">
                    </div>
                </div>
            </div>
        </div>
        <!-- Akhir Bagian Data Operasi -->


        <!-- Bagian 1: Durasi Conveyor dengan Dropdown Selector -->
        <h2 class="text-xl font-bold text-gray-800 mb-3">1. Durasi Conveyor</h2>

        <!-- Dropdown Selector -->
        <div class="mb-4">
            <label for="sdSelector" class="block text-sm font-medium text-gray-700 mb-1">Pilih Conveyor:</label>
            <select id="sdSelector" onchange="showTab(this.value)" class="w-full sm:w-1/3 p-3 border border-gray-300 rounded-lg text-base shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 font-semibold">
                <option value="SD1">SD1</option>
                <option value="SD2">SD2</option>
                <option value="SD3">SD3</option>
            </select>
        </div>
        
        <!-- Tab Content Container -->
        <div id="tab-content-container">
            <div id="SD1-content" class="tab-content">
                <!-- Header Kolom Waktu -->
                <div class="hidden sm:grid grid-cols-12 gap-4 text-sm font-bold text-gray-700 mb-2 border-b pb-2">
                    <div class="col-span-1 text-center">No.</div>
                    <div class="col-span-5 text-center">Waktu Mulai (Jam:Menit)</div>
                    <div class="col-span-4 text-center">Waktu Selesai (Jam:Menit)</div>
                    <div class="col-span-1 text-center">Durasi</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="entriesContainer-SD1" class="space-y-4"></div>
            </div>

            <div id="SD2-content" class="tab-content hidden">
                <div class="hidden sm:grid grid-cols-12 gap-4 text-sm font-bold text-gray-700 mb-2 border-b pb-2">
                    <div class="col-span-1 text-center">No.</div>
                    <div class="col-span-5 text-center">Waktu Mulai (Jam:Menit)</div>
                    <div class="col-span-4 text-center">Waktu Selesai (Jam:Menit)</div>
                    <div class="col-span-1 text-center">Durasi</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="entriesContainer-SD2" class="space-y-4"></div>
            </div>

            <div id="SD3-content" class="tab-content hidden">
                <div class="hidden sm:grid grid-cols-12 gap-4 text-sm font-bold text-gray-700 mb-2 border-b pb-2">
                    <div class="col-span-1 text-center">No.</div>
                    <div class="col-span-5 text-center">Waktu Mulai (Jam:Menit)</div>
                    <div class="col-span-4 text-center">Waktu Selesai (Jam:Menit)</div>
                    <div class="col-span-1 text-center">Durasi</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="entriesContainer-SD3" class="space-y-4"></div>
            </div>
            
            <button type="button" onclick="addEntry(activeSD)" class="w-full sm:w-auto flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 mt-6">
                + Tambah Baris Waktu untuk <span id="currentSDName">SD1</span>
            </button>
        </div>


        <!-- Hasil Perhitungan Total Durasi UNTUK SEMUA SD (TANPA BOX BACKGROUND) -->
        <div id="results" class="mt-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">HASIL DURASI CONVEYOR</h2>

            <div id="sd-results-container" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                
                <!-- SD1 Results -->
                <div class="p-0 bg-transparent rounded-none shadow-none border-none">
                    <h3 class="font-bold text-lg text-blue-700 mb-2 border-b pb-1">SD1</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-600">Total Durasi Indikasi:</span>
                            <span id="totalDisplay-SD1" class="font-extrabold text-red-600">0 Jam 0 Menit</span>
                        </div>

                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="font-bold text-gray-800">EFEKTIVITAS RUNNING:</span>
                            <span id="remainingDisplay-SD1" class="font-extrabold text-green-600">12 Jam 0 Menit</span>
                        </div>
                    </div>
                </div>

                <!-- SD2 Results -->
                <div class="p-0 bg-transparent rounded-none shadow-none border-none">
                    <h3 class="font-bold text-lg text-blue-700 mb-2 border-b pb-1">SD2</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-600">Total Durasi Indikasi:</span>
                            <span id="totalDisplay-SD2" class="font-extrabold text-red-600">0 Jam 0 Menit</span>
                        </div>

                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="font-bold text-gray-800">EFEKTIVITAS RUNNING:</span>
                            <span id="remainingDisplay-SD2" class="font-extrabold text-green-600">12 Jam 0 Menit</span>
                        </div>
                    </div>
                </div>

                <!-- SD3 Results -->
                <div class="p-0 bg-transparent rounded-none shadow-none border-none">
                    <h3 class="font-bold text-lg text-blue-700 mb-2 border-b pb-1">SD3</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-600">Total Durasi Indikasi:</span>
                            <span id="totalDisplay-SD3" class="font-extrabold text-red-600">0 Jam 0 Menit</span>
                        </div>

                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="font-bold text-gray-800">EFEKTIVITAS RUNNING:</span>
                            <span id="remainingDisplay-SD3" class="font-extrabold text-green-600">12 Jam 0 Menit</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bagian 2: Kalkulator Perhitungan Unit Running (TANPA BOX BACKGROUND) -->
        <div class="mt-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-3">2. Perhitungan Unit Running</h2>

            <div class="space-y-6">
                <!-- Section 1: MHA (Warna ORANYE) -->
                <div id="mha-section" class="p-4 rounded-lg bg-white shadow border border-orange-300">
                    <h3 class="text-xl font-bold text-orange-700 mb-4">1. MHA</h3>
                    <!-- Input Shift Siang dan Malam (Berdampingan di Mobile) -->
                    <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                        <!-- SHIFT SIANG -->
                        <div class="border-b border-gray-200 sm:border-b-0 pb-3 sm:pb-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT SIANG</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Siang:</label>
                                <input type="number" id="mha-running-siang" placeholder="Running Siang..." min="0" oninput="calculateUnitResult('mha')"
                                       class="unit-input w-full focus:border-orange-500 focus:ring-orange-200">
                                
                                <label class="block font-medium text-gray-600 pt-2 text-sm">Trip Unit Siang:</label>
                                <input type="number" id="mha-trip-siang" placeholder="Trip Siang..." min="0" oninput="calculateUnitResult('mha')"
                                       class="unit-input w-full focus:border-orange-500 focus:ring-orange-200">
                            </div>
                        </div>
                        <!-- SHIFT MALAM -->
                        <div class="sm:border-l sm:pl-6 pt-3 sm:pt-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT MALAM</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Malam:</label>
                                <input type="number" id="mha-running-malam" placeholder="Running Malam..." min="0" oninput="calculateUnitResult('mha')"
                                       class="unit-input w-full focus:border-orange-500 focus:ring-orange-200">
                                
                                <div class="grid grid-cols-2 gap-2 mt-2 items-end">
                                    <!-- Kolom Input Trip Unit Malam -->
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1">Trip Unit Malam:</label>
                                        <input type="number" id="mha-trip-malam" placeholder="Trip Malam..." min="0" oninput="calculateUnitResult('mha')"
                                            class="unit-input focus:border-orange-500 focus:ring-orange-200">
                                    </div>
                                    <!-- Kolom Selisih Trip (M-S) - Inline -->
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1 text-right invisible">Trip M - S:</label>
                                        <span id="mha-trip-selisih-inline" class="output-display w-full">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- HASIL MHA (Hanya 2 Kolom) -->
                    <div class="mt-6 pt-4 border-t-2 border-orange-500 grid grid-cols-2 gap-3">
                        <div class="p-3 bg-orange-100 rounded-lg">
                            <span class="font-bold text-orange-800 block text-sm">Hasil 2 Trip (Siang):</span>
                            <span id="mha-hasil-siang" class="font-extrabold text-xl sm:text-2xl text-red-600">0</span>
                        </div>
                        <div class="p-3 bg-orange-100 rounded-lg">
                            <span class="font-bold text-orange-800 block text-sm">Hasil 2 Trip (Malam):</span>
                            <span id="mha-hasil-malam" class="font-extrabold text-xl sm:text-2xl text-red-700">0</span>
                        </div>
                        <!-- KOLOM TRIP M - S DIHAPUS DARI SINI -->
                    </div>
                </div>
                
                <!-- Section 2: Karunia -->
                <div id="karunia-section" class="p-4 rounded-lg bg-white shadow border border-green-300">
                    <h3 class="text-xl font-bold text-green-700 mb-4">2. KARUNIA</h3>
                    <!-- Input Shift Siang dan Malam (Berdampingan di Mobile) -->
                    <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                        <!-- SHIFT SIANG -->
                        <div class="border-b border-gray-200 sm:border-b-0 pb-3 sm:pb-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT SIANG</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Siang:</label>
                                <input type="number" id="karunia-running-siang" placeholder="Running Siang..." min="0" oninput="calculateUnitResult('karunia')"
                                       class="unit-input w-full focus:border-green-500 focus:ring-green-200">
                                
                                <label class="block font-medium text-gray-600 pt-2 text-sm">Trip Unit Siang:</label>
                                <input type="number" id="karunia-trip-siang" placeholder="Trip Siang..." min="0" oninput="calculateUnitResult('karunia')"
                                       class="unit-input w-full focus:border-green-500 focus:ring-green-200">
                            </div>
                        </div>
                        <!-- SHIFT MALAM -->
                        <div class="sm:border-l sm:pl-6 pt-3 sm:pt-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT MALAM</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Malam:</label>
                                <input type="number" id="karunia-running-malam" placeholder="Running Malam..." min="0" oninput="calculateUnitResult('karunia')"
                                       class="unit-input w-full focus:border-green-500 focus:ring-green-200">
                                
                                <div class="grid grid-cols-2 gap-2 mt-2 items-end">
                                    <!-- Kolom Input Trip Unit Malam -->
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1">Trip Unit Malam:</label>
                                        <input type="number" id="karunia-trip-malam" placeholder="Trip Malam..." min="0" oninput="calculateUnitResult('karunia')"
                                            class="unit-input focus:border-green-500 focus:ring-green-200">
                                    </div>
                                    <!-- Kolom Selisih Trip (M-S) - Inline -->
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1 text-right invisible">Trip M - S:</label>
                                        <span id="karunia-trip-selisih-inline" class="output-display w-full">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- HASIL KARUNIA (Hanya 2 Kolom) -->
                    <div class="mt-6 pt-4 border-t-2 border-green-500 grid grid-cols-2 gap-3">
                        <div class="p-3 bg-green-100 rounded-lg">
                            <span class="font-bold text-green-800 block text-sm">Hasil 2 Trip (Siang):</span>
                            <span id="karunia-hasil-siang" class="font-extrabold text-xl sm:text-2xl text-red-600">0</span>
                        </div>
                        <div class="p-3 bg-green-100 rounded-lg">
                            <span class="font-bold text-green-800 block text-sm">Hasil 2 Trip (Malam):</span>
                            <span id="karunia-hasil-malam" class="font-extrabold text-xl sm:text-2xl text-red-700">0</span>
                        </div>
                        <!-- KOLOM TRIP M - S DIHAPUS DARI SINI -->
                    </div>
                </div>
                
                <!-- Section 3: BUMA -->
                <div id="buma-section" class="p-4 rounded-lg bg-white shadow border border-yellow-300">
                    <h3 class="text-xl font-bold text-yellow-700 mb-4">3. BUMA</h3>
                    <!-- Input Shift Siang dan Malam (Berdampingan di Mobile) -->
                    <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                        <!-- SHIFT SIANG -->
                        <div class="border-b border-gray-200 sm:border-b-0 pb-3 sm:pb-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT SIANG</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Siang:</label>
                                <input type="number" id="buma-running-siang" placeholder="Running Siang..." min="0" oninput="calculateUnitResult('buma')"
                                       class="unit-input w-full focus:border-yellow-500 focus:ring-yellow-200">
                                
                                <label class="block font-medium text-gray-600 pt-2 text-sm">Trip Unit Siang:</label>
                                <input type="number" id="buma-trip-siang" placeholder="Trip Siang..." min="0" oninput="calculateUnitResult('buma')"
                                       class="unit-input w-full focus:border-yellow-500 focus:ring-yellow-200">
                            </div>
                        </div>
                        <!-- SHIFT MALAM -->
                        <div class="sm:border-l sm:pl-6 pt-3 sm:pt-0">
                            <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">SHIFT MALAM</h4>
                            <div class="space-y-3">
                                <label class="block font-medium text-gray-600 text-sm">Unit Running Malam:</label>
                                <input type="number" id="buma-running-malam" placeholder="Running Malam..." min="0" oninput="calculateUnitResult('buma')"
                                       class="unit-input w-full focus:border-yellow-500 focus:ring-yellow-200">
                                
                                <div class="grid grid-cols-2 gap-2 mt-2 items-end">
                                    <!-- Kolom Input Trip Unit Malam -->
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1">Trip Unit Malam:</label>
                                        <input type="number" id="buma-trip-malam" placeholder="Trip Malam..." min="0" oninput="calculateUnitResult('buma')"
                                            class="unit-input focus:border-yellow-500 focus:ring-yellow-200">
                                    </div>
                                    <!-- Kolom Selisih Trip (M-S) - Inline -->
                                    <div class="flex flex-col">
                                        <label class="font-medium text-gray-600 text-sm mb-1 text-right invisible">Trip M - S:</label>
                                        <span id="buma-trip-selisih-inline" class="output-display w-full">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- HASIL BUMA (Hanya 2 Kolom) -->
                    <div class="mt-6 pt-4 border-t-2 border-yellow-500 grid grid-cols-2 gap-3">
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <span class="font-bold text-yellow-800 block text-sm">Hasil 2 Trip (Siang):</span>
                            <span id="buma-hasil-siang" class="font-extrabold text-xl sm:text-2xl text-red-600">0</span>
                        </div>
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <span class="font-bold text-yellow-800 block text-sm">Hasil 2 Trip (Malam):</span>
                            <span id="buma-hasil-malam" class="font-extrabold text-xl sm:text-2xl text-red-700">0</span>
                        </div>
                        <!-- KOLOM TRIP M - S DIHAPUS DARI SINI -->
                    </div>
                </div>
            </div>

            <!-- Bagian HASIL (Total Trip Siang & Malam) -->
            <div class="mt-8 p-5 bg-indigo-50 border-2 border-indigo-400 rounded-lg shadow-md">
                <h3 class="text-xl font-bold text-indigo-800 mb-3 border-b pb-2">HASIL Total Trip</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-lg text-gray-700">Total Trip Unit Siang (MHA+Karunia+Buma):</span>
                        <span id="grand-total-trip-siang" class="font-extrabold text-2xl text-indigo-600">0</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-indigo-200">
                        <span class="font-semibold text-lg text-gray-700">Total Trip Unit Malam (MHA+Karunia+Buma):</span>
                        <span id="grand-total-trip-malam" class="font-extrabold text-2xl text-indigo-600">0</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-indigo-200">
                        <span class="font-semibold text-lg text-gray-700">Total Trip Malam - Total Trip Siang:</span>
                        <span id="grand-total-trip-difference" class="font-extrabold text-2xl text-red-600">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bagian 3: FINAL TOMBOL LAPORAN (Di Bawah Semua) -->
        <div class="mt-12 p-6 bg-purple-100 rounded-xl shadow-2xl border border-purple-400">
            <h2 class="text-2xl font-bold text-purple-800 mb-4 border-b pb-3">SALIN LAPORAN LENGKAP</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Tombol Salin Laporan Harian (Siang) -->
                <button type="button" onclick="copyDailyReportSiang()" class="w-full bg-purple-600 text-white py-4 px-4 rounded-xl hover:bg-purple-700 transition duration-150 font-extrabold shadow-lg text-lg focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-offset-2">
                    <div class="flex items-center justify-center">
                        Laporan Harian SIANG
                    </div>
                </button>

                <!-- Tombol Salin Laporan Harian (Malam) -->
                <button type="button" onclick="copyDailyReportMalam()" class="w-full bg-purple-900 text-white py-4 px-4 rounded-xl hover:bg-purple-950 transition duration-150 font-extrabold shadow-lg text-lg focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-offset-2">
                    <div class="flex items-center justify-center">
                        Laporan Harian MALAM
                    </div>
                </button>
            </div>
        </div>


    <!-- Area Pesan (Modal) -->
        <div id="messageBox" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden" onclick="hideMessage()">
            <div class="bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full mx-4" onclick="event.stopPropagation()">
                <h3 id="messageTitle" class="text-lg font-bold text-gray-900 mb-2"></h3>
                <p id="messageContent" class="text-gray-700 mb-4"></p>
                <button onclick="hideMessage()" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        // --- DEKLARASI GLOBAL & DATA ---
        let entryCount = { SD1: 0, SD2: 0, SD3: 0 };
        const entryData = { SD1: [], SD2: [], SD3: [] };
        let activeSD = 'SD1';
        const SPV_LIST = ['Ihsan R', 'Dicky F', 'Sopian']; // Daftar Supervisor
        const FOREMAN_LIST = ['Gunawan TC', 'Hardiansyah', 'Lewi S', 'Elimelek J', 'Andry K']; // Daftar Foreman
        const CHECKER_LIST = ['Indra R', 'Jemmie P', 'Ikram', 'Fahri T', 'Indra A', 'Andhy S', 'Agus', 'Angga', 'Henderi A', 'L Fauzan N', 'Nanda P']; // Daftar Checker
        
        const formatter = new Intl.NumberFormat('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
        const MAX_SHIFT_MINUTES = 12 * 60; // 720 minutes

        const hourOptions = createTimeOptions(23, 'Jam');
        const minuteOptions = createTimeOptions(59, 'Menit');

        // --- DOM ELEMENTS (Global references) ---
        const tabContents = document.querySelectorAll('.tab-content');
        const currentSDName = document.getElementById('currentSDName');
        const sdNames = ['SD1', 'SD2', 'SD3']; // List of all SDs for copying

        // --- FUNGSI UTILITY ---
        function createTimeOptions(max, placeholderText) {
            let options = `<option value="" selected disabled>${placeholderText}</option>`; 
            for (let i = 0; i <= max; i++) {
                const val = String(i).padStart(2, '0');
                options += `<option value="${i}">${val}</option>`;
            }
            return options;
        }

        function showMessage(title, content) {
            const messageBox = document.getElementById('messageBox');
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').textContent = content;
            messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('messageBox').classList.add('hidden');
        }

        function minutesToTime(totalMinutes) {
            const sign = totalMinutes < 0 ? '-' : '';
            totalMinutes = Math.abs(totalMinutes);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            return `${sign}${String(hours).padStart(1, '0')} Jam ${String(minutes).padStart(2, '0')} Menit`;
        }
        
        // Fungsi untuk mengambil nilai input dan mengembalikan '-' jika kosong
        const getReportValue = (elementId, numeric = true) => {
            const el = document.getElementById(elementId);
            if (!el) return '-';

            const val = el.value.trim();
            if (val === '') {
                return '-';
            }
            // Jika dropdown, nilai diambil langsung dari value, bukan float
            if (el.tagName === 'SELECT' && !numeric) {
                 return val;
            }
            
            return numeric ? (parseFloat(val) || 0) : val;
        };
        
        // Fungsi untuk memformat tanggal dari YYYY-MM-DD ke DD/BULAN/YY
        function formatDateForReport(dateString) {
            if (!dateString || dateString === '-') return '-';
            
            const [year, month, day] = dateString.split('-');
            const shortYear = year.slice(-2);
            const monthNames = [
                "JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI",
                "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"
            ];
            const monthIndex = parseInt(month, 10) - 1;
            const monthName = monthNames[monthIndex];

            return `${day}/${monthName.substring(0, 3)}/${shortYear}`;
        }


        // --- FUNGSI TAB INTERFACE ---
        function showTab(sdName) {
            activeSD = sdName;
            currentSDName.textContent = sdName;

            tabContents.forEach(content => content.classList.add('hidden'));
            document.getElementById(`${sdName}-content`).classList.remove('hidden');

            calculateAllTotals();
        }

        // --- FUNGSI PERHITUNGAN CONVEYOR ---

        function calculateDuration(sdName, index) {
            const data = entryData[sdName][index];
            if (!data) return 0;

            let startMinutes = data.startHour * 60 + data.startMinute;
            let finishMinutes = data.finishHour * 60 + data.finishMinute;
            
            // Penanganan Lintasan Tengah Malam
            if (finishMinutes < startMinutes) {
                finishMinutes += 1440; // Tambah 24 jam (1440 menit)
            }

            const durationMinutes = finishMinutes - startMinutes;
            
            const durationDisplay = document.getElementById(`duration-${sdName}-${index}`);
            const durationMobileDisplay = document.getElementById(`duration-mobile-${sdName}-${index}`);
            
            if (durationMinutes < 0) {
                const errorStr = 'ERR';
                durationDisplay.textContent = errorStr;
                durationMobileDisplay.textContent = errorStr;
                return 0;
            }

            const durationStr = minutesToTime(durationMinutes).replace(' Jam', ':').replace(' Menit', '');
            durationDisplay.textContent = durationStr;
            durationMobileDisplay.textContent = durationStr;
            
            return durationMinutes;
        }

        function calculateAllTotals() {
            let totalSD1 = 0;
            let totalSD2 = 0;
            let totalSD3 = 0;

            // Hitung SD1
            entryData.SD1.forEach((data, index) => {
                const minutes = calculateDuration('SD1', index);
                totalSD1 += minutes;
            });
            // Hitung SD2
            entryData.SD2.forEach((data, index) => {
                const minutes = calculateDuration('SD2', index);
                totalSD2 += minutes;
            });
            // Hitung SD3
            entryData.SD3.forEach((data, index) => {
                const minutes = calculateDuration('SD3', index);
                totalSD3 += minutes;
            });

            // Update DOM Results
            updateResultDisplay('SD1', totalSD1);
            updateResultDisplay('SD2', totalSD2);
            updateResultDisplay('SD3', totalSD3);
        }

        function updateResultDisplay(sdName, totalMinutes) {
            const totalDisplay = document.getElementById(`totalDisplay-${sdName}`);
            const remainingDisplay = document.getElementById(`remainingDisplay-${sdName}`);
            
            const totalHours = Math.floor(totalMinutes / 60);
            const totalMins = totalMinutes % 60;
            
            // 1. Total Durasi Indikasi
            totalDisplay.innerHTML = `
                <span class="text-red-600">${formatter.format(totalHours)}</span> Jam 
                <span class="text-red-600">${formatter.format(totalMins)}</span> Menit 
            `;

            // --- Logika Baru: Tampilkan '-' jika totalMinutes = 0 ---
            if (totalMinutes === 0) {
                remainingDisplay.innerHTML = `<span class="font-extrabold text-gray-500">-</span>`;
                // Set dataset for copying purposes to '-'
                const resultsEl = document.getElementById('results');
                if (resultsEl) resultsEl.dataset[`remainingText-${sdName}`] = `-`;
                return; // Keluar dari fungsi
            }
            // --- Akhir Logika Baru ---


            // 2. EFEKTIVITAS RUNNING (12 hours - Total)
            let remainingMinutes = MAX_SHIFT_MINUTES - totalMinutes;
            
            let remainingText = '';
            let remainingColor = ''; 
            let excessTag = ''; 

            let finalMinutesForCopy = remainingMinutes; 

            if (remainingMinutes >= 0) {
                const remainingHours = Math.floor(remainingMinutes / 60);
                const remainingMins = remainingMinutes % 60;
                remainingColor = 'text-green-600';
                
                remainingText = `${formatter.format(remainingHours)} Jam ${String(remainingMins).padStart(2, '0')} Menit`;
            } else {
                finalMinutesForCopy = Math.abs(remainingMinutes);
                const excessHours = Math.floor(finalMinutesForCopy / 60);
                const excessMins = finalMinutesForCopy % 60;
                remainingColor = 'text-red-600';
                excessTag = ' (Kelebihan Durasi)'; 

                remainingText = `${formatter.format(excessHours)} Jam ${String(excessMins).padStart(2, '0')} Menit`;
            }

            // Display Remaining Duration
            remainingDisplay.innerHTML = `<span class="${remainingColor}">${remainingText}</span>`;
            
            // Simpan teks mentah sisa durasi untuk penyalinan (hanya teks H:MM)
            const finalHours = Math.floor(finalMinutesForCopy / 60);
            const finalMins = finalMinutesForCopy % 60;
            // Menyimpan format yang diminta: "H Jam MM Menit"
            const resultsEl = document.getElementById('results');
            if (resultsEl) resultsEl.dataset[`remainingText-${sdName}`] = `${finalHours} Jam ${String(finalMins).padStart(2, '0')} Menit${excessTag}`;
        }

        // --- FUNGSI MANIPULASI DOM ---

        function updateEntryData(sdName, entryIndex) {
            const startHour = parseInt(document.getElementById(`startHour-${sdName}-${entryIndex}`).value);
            const startMinute = parseInt(document.getElementById(`startMinute-${sdName}-${entryIndex}`).value);
            const finishHour = parseInt(document.getElementById(`finishHour-${sdName}-${entryIndex}`).value);
            const finishMinute = parseInt(document.getElementById(`finishMinute-${sdName}-${entryIndex}`).value);
            
            entryData[sdName][entryIndex] = {
                startHour: isNaN(startHour) ? 0 : startHour,
                startMinute: isNaN(startMinute) ? 0 : startMinute,
                finishHour: isNaN(finishHour) ? 0 : finishHour,
                finishMinute: isNaN(finishMinute) ? 0 : finishMinute
            };

            calculateAllTotals();
        }

        function addEntry(sdName) {
            const container = document.getElementById(`entriesContainer-${sdName}`);
            entryCount[sdName]++;
            const entryIndex = entryCount[sdName];
            
            entryData[sdName].push({ startHour: 0, startMinute: 0, finishHour: 0, finishMinute: 0 });
            const dataIndex = entryData[sdName].length - 1;

            const entryDiv = document.createElement('div');
            entryDiv.id = `entry-row-${sdName}-${dataIndex}`;
            entryDiv.className = 'grid grid-cols-12 gap-2 sm:gap-4 items-center bg-gray-50 p-3 rounded-xl border border-gray-200';
            entryDiv.innerHTML = `
                <!-- No. (col-span-1) -->
                <div class="col-span-1 text-center font-bold text-gray-700 text-sm sm:text-base">${dataIndex + 1}.</div>
                
                <!-- Waktu Mulai H:M (Mobile: col-span-5, Desktop: col-span-5) -->
                <div class="col-span-5 sm:col-span-5 flex gap-1 items-center">
                    <label class="text-sm text-gray-500 font-medium">Mulai:</label>
                    <select id="startHour-${sdName}-${dataIndex}" class="w-1/2 p-2 border border-gray-300 rounded-md text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" onchange="updateEntryData('${sdName}', ${dataIndex})">
                        ${hourOptions}
                    </select>
                    <select id="startMinute-${sdName}-${dataIndex}" class="w-1/2 p-2 border border-gray-300 rounded-md text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" onchange="updateEntryData('${sdName}', ${dataIndex})">
                        ${minuteOptions}
                    </select>
                </div>

                <!-- Waktu Selesai H:M (Mobile: col-span-5, Desktop: col-span-4) -->
                <div class="col-span-5 sm:col-span-4 flex gap-1 items-center">
                    <label class="text-sm text-gray-500 font-medium">Selesai:</label>
                    <select id="finishHour-${sdName}-${dataIndex}" class="w-1/2 p-2 border border-gray-300 rounded-md text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" onchange="updateEntryData('${sdName}', ${dataIndex})">
                        ${hourOptions}
                    </select>
                    <select id="finishMinute-${sdName}-${dataIndex}" class="w-1/2 p-2 border border-gray-300 rounded-md text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" onchange="updateEntryData('${sdName}', ${dataIndex})">
                        ${minuteOptions}
                    </select>
                </div>
                
                <!-- Durasi (Desktop: col-span-1) -->
                <div class="hidden sm:block col-span-1 text-center text-sm font-bold text-indigo-600">
                    <span id="duration-${sdName}-${dataIndex}">00:00</span>
                </div>
                
                <!-- Tombol Hapus (Mobile: col-span-1) -->
                <div class="col-span-1 text-center sm:col-span-1">
                    <button type="button" onclick="removeEntry('${sdName}', ${dataIndex})" class="text-red-500 hover:text-red-700 transition duration-150 p-1 rounded-full hover:bg-red-100" aria-label="Hapus baris">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mx-auto">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Mobile Durasi Display (col-span-12, selalu baris baru) -->
                <div class="col-span-12 sm:hidden text-xs font-semibold text-gray-700 border-t border-gray-200 pt-2 mt-2 text-center">
                    Durasi Baris: <span id="duration-mobile-${sdName}-${dataIndex}" class="font-bold text-sm text-indigo-600">00:00</span>
                </div>
            `;
            container.appendChild(entryDiv);
            entryCount[sdName] = entryData[sdName].length; // Sinkronkan hitungan
            calculateAllTotals();
        }

        function removeEntry(sdName, indexToRemove) {
            const container = document.getElementById(`entriesContainer-${sdName}`);
            
            // Hapus dari DOM
            const entryRow = document.getElementById(`entry-row-${sdName}-${indexToRemove}`);
            if (entryRow) {
                container.removeChild(entryRow);
            }

            // Hapus dari data
            entryData[sdName].splice(indexToRemove, 1);
            entryCount[sdName] = entryData[sdName].length;

            // Update ulang ID dan penomoran di DOM
            const rows = container.children;
            for (let i = 0; i < rows.length; i++) {
                const oldDataIndex = parseInt(rows[i].id.split('-').pop());
                
                rows[i].id = `entry-row-${sdName}-${i}`;
                
                // Update penomoran
                const numDisplay = rows[i].querySelector('.col-span-1');
                if (numDisplay) {
                    numDisplay.textContent = `${i + 1}.`;
                }

                // Update event handlers dan IDs internal
                const oldIndex = oldDataIndex;
                const newIndex = i;

                rows[i].querySelector(`#startHour-${sdName}-${oldIndex}`).id = `startHour-${sdName}-${newIndex}`;
                rows[i].querySelector(`#startMinute-${sdName}-${oldIndex}`).id = `startMinute-${sdName}-${newIndex}`;
                rows[i].querySelector(`#finishHour-${sdName}-${oldIndex}`).id = `finishHour-${sdName}-${newIndex}`;
                rows[i].querySelector(`#finishMinute-${sdName}-${oldIndex}`).id = `finishMinute-${sdName}-${newIndex}`;

                rows[i].querySelector(`#duration-${sdName}-${oldIndex}`).id = `duration-${sdName}-${newIndex}`;
                rows[i].querySelector(`#duration-mobile-${sdName}-${oldIndex}`).id = `duration-mobile-${sdName}-${newIndex}`;

                const selects = rows[i].querySelectorAll('select');
                selects.forEach(select => {
                    select.setAttribute('onchange', `updateEntryData('${sdName}', ${newIndex})`);
                });
                
                rows[i].querySelector('button').setAttribute('onclick', `removeEntry('${sdName}', ${newIndex})`);
            }
            
            calculateAllTotals();
        }
        
        // --- FUNGSI COPY RESULT (EFEKTIVITAS) ---
        
        function copyAllRemainingDurations() {
            const resultsDiv = document.getElementById('results');
            let textToCopy = '';
            
            textToCopy += `Efektivitas Running\n`;

            sdNames.forEach(sdName => {
                const resultText = resultsDiv.dataset[`remainingText-${sdName}`] || '-'; 
                
                // Jika hasilnya '-', format tetap seperti yang diminta, namun nilainya '-'
                const finalResult = resultText === '-' ? '-' : resultText.replace(' (Kelebihan Durasi)', '');
                
                textToCopy += `${sdName} = ${finalResult}\n`;
            });
            
            // Buat elemen textarea sementara untuk menyalin
            const tempInput = document.createElement('textarea');
            tempInput.value = textToCopy.trim(); // Hapus baris kosong di akhir
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                showMessage('Berhasil Disalin!', 'Semua Efektivitas Running telah disalin ke clipboard.');
            } catch (err) {
                showMessage('Gagal Menyalin', 'Gagal menyalin teks. Silakan salin secara manual.');
            } finally {
                document.body.removeChild(tempInput);
            }
        }
        
        // --- FUNGSI PEMBANTU UNTUK MENGAMBIL NILAI HASIL UNIT 2 TRIP ---
        const getHasilValue = (sectionId, shift) => {
            const id = `${sectionId}-hasil-${shift}`;
            const el = document.getElementById(id);
            if (!el || !el.textContent) return 0;
            return parseFloat(el.textContent.replace(/,/g, '')) || 0;
        };
        
        // --- FUNGSI GABUNGAN PERSONEL ---
        
        function getSupervisorDisplayValue() {
            const checkboxes = document.querySelectorAll('#spvCheckboxes input[type="checkbox"]:checked');
            const primarySpvs = Array.from(checkboxes).map(cb => cb.value);
            
            let allSpvs = primarySpvs;
            
            const spvLainnyaInput = document.getElementById('inputSupervisorLainnya');
            const spvLainnya = spvLainnyaInput ? spvLainnyaInput.value.trim() : '';

            if (spvLainnya) {
                allSpvs.push(spvLainnya);
            }
            
            // Gabungkan semua nama dengan " & "
            return allSpvs.join(' & ');
        }

        function getForemanDisplayValue() {
            const checkboxes = document.querySelectorAll('#foremanCheckboxes input[type="checkbox"]:checked');
            const selectedForemen = Array.from(checkboxes).map(cb => cb.value);
            
            let allForemen = selectedForemen;
            
            const foremanLainnyaInput = document.getElementById('inputForemanLainnya');
            const foremanLainnya = foremanLainnyaInput ? foremanLainnyaInput.value.trim() : '';

            if (foremanLainnya) {
                allForemen.push(foremanLainnya);
            }
            
            // Gabungkan semua nama dengan " & "
            return allForemen.join(' & ');
        }
        
        function getCheckerDisplayValue() {
            const checkboxes = document.querySelectorAll('#checkerCheckboxes input[type="checkbox"]:checked');
            const selectedCheckers = Array.from(checkboxes).map(cb => cb.value);
            
            let allCheckers = selectedCheckers;
            
            const checkerLainnyaInput = document.getElementById('inputCheckerLainnya');
            const checkerLainnya = checkerLainnyaInput ? checkerLainnyaInput.value.trim() : '';

            if (checkerLainnya) {
                allCheckers.push(checkerLainnya);
            }
            
            // Gabungkan semua nama dengan " & "
            return allCheckers.join(' & ');
        }


        // --- FUNGSI SALIN LAPORAN HARIAN SIANG ---
        function copyDailyReportSiang() {
            let reportText = '';

            // Ambil Data Operasi
            const shift = getReportValue('inputShift', false);
            const rawTanggal = getReportValue('inputTanggal', false); 
            const tanggal = rawTanggal !== '-' ? formatDateForReport(rawTanggal) : '-';
            
            const supervisorDisplay = getSupervisorDisplayValue();
            const foremanDisplay = getForemanDisplayValue(); 
            const checkerDisplay = getCheckerDisplayValue(); // Ambil nilai gabungan Checker

            const tippingRom = getReportValue('inputTippingRom');
            const transferRom = getReportValue('inputTransferRom');


            // 0. Header Laporan
            reportText += `*CHP OPERATION*\n`;
            reportText += `*${shift.toUpperCase()}*\n`;
            reportText += `*${tanggal}*\n\n`;
            reportText += `Supervisor : ${supervisorDisplay}\n`; 
            reportText += `Foreman   : ${foremanDisplay}\n`; 
            reportText += `Checker      : ${checkerDisplay}\n\n`; // Gunakan variabel gabungan Checker
            
            
            // 1. Efektivitas Running
            const resultsDiv = document.getElementById('results');
            reportText += `Efektivitas Running\n`;
            sdNames.forEach(sdName => {
                const resultText = resultsDiv.dataset[`remainingText-${sdName}`] || '-'; 
                const finalResult = resultText === '-' ? '-' : resultText.replace(' (Kelebihan Durasi)', '');
                reportText += `- ${sdName} = ${finalResult}\n`;
            });
            reportText += `\n`;

            // 2. Trip Siang (Hauling Format)
            const mhaTrip = parseFloat(document.getElementById('mha-trip-siang').value) || 0;
            const karuniaTrip = parseFloat(document.getElementById('karunia-trip-siang').value) || 0;
            const bumaTrip = parseFloat(document.getElementById('buma-trip-siang').value) || 0;
            const kaiTrip = karuniaTrip; 
            const bTrip = bumaTrip; 
            const ipTrip = 0; 
            const totalHauling = mhaTrip + kaiTrip + bTrip + ipTrip;

            reportText += `Hauling\n`;
            reportText += `MHA    : ${mhaTrip} TRIP\n`;
            reportText += `BUMA   : ${bTrip} TRIP\n`; 
            reportText += `KAI    : ${kaiTrip} TRIP\n`;
            reportText += `IP     : ${ipTrip} TRIP\n`;
            reportText += `Total Hauling : ${totalHauling} Trip\n`;
            reportText += `\n`;
            
            // Tipping & Transfer ROM (Logika: tambahkan "Trip" hanya jika nilai bukan "-")
            reportText += `TIPPING ROM        = ${tippingRom}${tippingRom !== '-' ? ' Trip' : ''}\n`;
            reportText += `TRANSFER ROM   = ${transferRom}${transferRom !== '-' ? ' Trip' : ''}\n\n`;


            // 3. Unit 2 Trip (Siang) - Mengambil dari HASIL 2 TRIP SIANG
            
            const mhaUnit = getHasilValue('mha', 'siang');
            const bumaUnit = getHasilValue('buma', 'siang');
            const karuniaUnit = getHasilValue('karunia', 'siang'); 
            
            reportText += `Unit 2 Trip\n`;
            reportText += `- MHA   = ${mhaUnit} Unit\n`;
            reportText += `- BUMA  = ${bumaUnit} Unit\n`;
            reportText += `- KAI   = ${karuniaUnit} Unit\n`;

            // Salin ke clipboard
            const tempInput = document.createElement('textarea');
            tempInput.value = reportText.trim(); 
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                showMessage('Berhasil Disalin!', 'Laporan Harian (Efektivitas, Trip Siang, Unit 2 Trip Siang) telah disalin ke clipboard.');
            } catch (err) {
                showMessage('Gagal Menyalin', 'Gagal menyalin teks. Silakan salin secara manual.');
            } finally {
                document.body.removeChild(tempInput);
            }
        }
        
        // --- FUNGSI SALIN LAPORAN HARIAN MALAM (DENGAN RUMUS SELISIH TRIP) ---
        function copyDailyReportMalam() {
            let reportText = '';

            // Ambil Data Operasi
            const shift = getReportValue('inputShift', false);
            const rawTanggal = getReportValue('inputTanggal', false); 
            const tanggal = rawTanggal !== '-' ? formatDateForReport(rawTanggal) : '-'; 
            
            const supervisorDisplay = getSupervisorDisplayValue();
            const foremanDisplay = getForemanDisplayValue(); // Ambil nilai gabungan Foreman
            const checkerDisplay = getCheckerDisplayValue(); // Ambil nilai gabungan Checker


            const tippingRom = getReportValue('inputTippingRom');
            const transferRom = getReportValue('inputTransferRom');

            // 0. Header Laporan
            reportText += `*CHP OPERATION*\n`;
            reportText += `*${shift.toUpperCase()}*\n`;
            reportText += `*${tanggal}*\n\n`;
            reportText += `Supervisor : ${supervisorDisplay}\n`; 
            reportText += `Foreman   : ${foremanDisplay}\n`; // Gunakan variabel gabungan Foreman
            reportText += `Checker      : ${checkerDisplay}\n\n`; // Gunakan variabel gabungan Checker


            // Ambil input Trip Siang dan Malam
            const mhaTripSiang = parseFloat(document.getElementById('mha-trip-siang').value) || 0;
            const karuniaTripSiang = parseFloat(document.getElementById('karunia-trip-siang').value) || 0;
            const bumaTripSiang = parseFloat(document.getElementById('buma-trip-siang').value) || 0;
            
            const mhaTripMalam = parseFloat(document.getElementById('mha-trip-malam').value) || 0;
            const karuniaTripMalam = parseFloat(document.getElementById('karunia-trip-malam').value) || 0;
            const bumaTripMalam = parseFloat(document.getElementById('buma-trip-malam').value) || 0;

            // 1. Efektivitas Running
            const resultsDiv = document.getElementById('results');
            reportText += `Efektivitas Running\n`;
            sdNames.forEach(sdName => {
                const resultText = resultsDiv.dataset[`remainingText-${sdName}`] || '-'; 
                const finalResult = resultText === '-' ? '-' : resultText.replace(' (Kelebihan Durasi)', '');
                reportText += `- ${sdName} = ${finalResult}\n`;
            });
            reportText += `\n`;

            // 2. Trip Malam (Hauling Format - Menggunakan Selisih Trip Malam - Trip Siang)
            const mhaTripSelisih = mhaTripMalam - mhaTripSiang;
            const karuniaTripSelisih = karuniaTripMalam - karuniaTripSiang;
            const bumaTripSelisih = bumaTripMalam - bumaTripSiang;
            
            const kaiTrip = karuniaTripSelisih; // KAI diambil dari Selisih Karunia
            const bTrip = bumaTripSelisih; // BUMA diambil dari Selisih Buma
            const ipTrip = 0; // IP tetap 0 (placeholder)
            const totalHauling = mhaTripSelisih + kaiTrip + bTrip + ipTrip; // Total Hauling menggunakan selisih trip

            reportText += `Hauling\n`;
            reportText += `MHA    : ${mhaTripSelisih} TRIP\n`;
            reportText += `BUMA   : ${bTrip} TRIP\n`; 
            reportText += `KAI    : ${kaiTrip} TRIP\n`;
            reportText += `IP     : ${ipTrip} TRIP\n`;
            reportText += `Total Hauling : ${totalHauling} Trip\n`;
            reportText += `\n`;

            // Tipping & Transfer ROM (Logika: tambahkan "Trip" hanya jika nilai bukan "-")
            reportText += `TIPPING ROM        = ${tippingRom}${tippingRom !== '-' ? ' Trip' : ''}\n`;
            reportText += `TRANSFER ROM   = ${transferRom}${transferRom !== '-' ? ' Trip' : ''}\n\n`;


            // 3. Unit 2 Trip (Malam) - Mengambil dari HASIL 2 TRIP MALAM
            
            const mhaUnit = getHasilValue('mha', 'malam');
            const bumaUnit = getHasilValue('buma', 'malam');
            const karuniaUnit = getHasilValue('karunia', 'malam'); 
            
            reportText += `Unit 2 Trip\n`;
            reportText += `- MHA   = ${mhaUnit} Unit\n`;
            reportText += `- BUMA  = ${bumaUnit} Unit\n`;
            reportText += `- KAI   = ${karuniaUnit} Unit\n`;

            // Salin ke clipboard
            const tempInput = document.createElement('textarea');
            tempInput.value = reportText.trim(); 
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                showMessage('Berhasil Disalin!', 'Laporan Harian (Efektivitas, Trip Malam Selisih, Unit 2 Trip Malam) telah disalin ke clipboard.');
            } catch (err) {
                showMessage('Gagal Menyalin', 'Gagal menyalin teks. Silakan salin secara manual.');
            } finally {
                document.body.removeChild(tempInput);
            }
        }

        // --- FUNGSI INIT & UNIT RUNNING ---

        function initUnitCalculations() {
            // Memastikan semua hasil unit running terhitung saat load
            ['mha', 'karunia', 'buma'].forEach(id => calculateUnitResult(id));
            calculateGrandTotalUnits(); 
        }

        function populateSpvCheckboxes() {
            const container = document.getElementById('spvCheckboxes');
            container.innerHTML = ''; 

            SPV_LIST.forEach(spvName => {
                const id = `spv-cb-${spvName.replace(/\s/g, '-')}`;
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type="checkbox" id="${id}" value="${spvName}" 
                           class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="${id}" class="ml-2 text-sm font-semibold text-gray-800">${spvName}</label>
                `;
                container.appendChild(div);
            });
        }
        
        function populateForemanCheckboxes() {
            const container = document.getElementById('foremanCheckboxes');
            container.innerHTML = ''; 

            FOREMAN_LIST.forEach(foremanName => {
                const id = `foreman-cb-${foremanName.replace(/\s/g, '-')}`;
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type="checkbox" id="${id}" value="${foremanName}" 
                           class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="${id}" class="ml-2 text-sm font-semibold text-gray-800">${foremanName}</label>
                `;
                container.appendChild(div);
            });
        }
        
        function populateCheckerCheckboxes() {
            const container = document.getElementById('checkerCheckboxes');
            container.innerHTML = ''; 

            CHECKER_LIST.forEach(checkerName => {
                const id = `checker-cb-${checkerName.replace(/\s/g, '-')}`;
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type="checkbox" id="${id}" value="${checkerName}" 
                           class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="${id}" class="ml-2 text-sm font-semibold text-gray-800">${checkerName}</label>
                `;
                container.appendChild(div);
            });
        }


        window.onload = function() {
            // Inisialisasi Dropdown dan entri awal
            const sdSelector = document.getElementById('sdSelector');
            sdSelector.value = 'SD1'; 
            showTab('SD1');
            
            // Menambahkan 2 baris default
            addEntry('SD1');
            addEntry('SD1');
            
            addEntry('SD2');
            addEntry('SD3');

            // Inisialisasi Checkboxes Personel
            populateSpvCheckboxes();
            populateForemanCheckboxes();
            populateCheckerCheckboxes();
            
            // Inisialisasi perhitungan unit
            initUnitCalculations();
            
            // Set tanggal default ke hari ini
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('inputTanggal').value = `${yyyy}-${mm}-${dd}`;
        };

        function calculateGrandTotalUnits() {
            const sections = ['mha', 'karunia', 'buma'];
            let grandTotalTripSiang = 0;
            let grandTotalTripMalam = 0;

            sections.forEach(sectionId => {
                const tripSiang = parseFloat(document.getElementById(`${sectionId}-trip-siang`).value) || 0;
                grandTotalTripSiang += tripSiang;

                const tripMalam = parseFloat(document.getElementById(`${sectionId}-trip-malam`).value) || 0;
                grandTotalTripMalam += tripMalam;
            });

            // Calculate Difference
            const tripDifference = grandTotalTripMalam - grandTotalTripSiang;

            // Update DOM
            document.getElementById('grand-total-trip-siang').textContent = formatter.format(grandTotalTripSiang);
            document.getElementById('grand-total-trip-malam').textContent = formatter.format(grandTotalTripMalam);
            document.getElementById('grand-total-trip-difference').textContent = formatter.format(tripDifference);
        }

        function calculateUnitResult(sectionId) {
            const runningSiang = parseFloat(document.getElementById(`${sectionId}-running-siang`).value) || 0;
            const tripSiang = parseFloat(document.getElementById(`${sectionId}-trip-siang`).value) || 0;
            const runningMalam = parseFloat(document.getElementById(`${sectionId}-running-malam`).value) || 0;
            const tripMalam = parseFloat(document.getElementById(`${sectionId}-trip-malam`).value) || 0;

            // Hasil Siang (Rumus: Trip Siang - Running Siang)
            const hasilSiang = tripSiang - runningSiang;
            
            // Hasil Trip Malam - Trip Siang (Selisih M-S)
            const tripDifference = tripMalam - tripSiang;
            
            // Hasil Malam (Rumus: (Trip Malam - Trip Siang) - Unit Running Malam)
            const hasilMalam = tripDifference - runningMalam;
            
            // --- UPDATE DOM ---
            const hasilSiangEl = document.getElementById(`${sectionId}-hasil-siang`);
            const hasilMalamEl = document.getElementById(`${sectionId}-hasil-malam`);
            const tripSelisihInlineEl = document.getElementById(`${sectionId}-trip-selisih-inline`); 

            if (hasilSiangEl) hasilSiangEl.textContent = formatter.format(hasilSiang);
            if (hasilMalamEl) hasilMalamEl.textContent = formatter.format(hasilMalam);
            if (tripSelisihInlineEl) tripSelisihInlineEl.textContent = formatter.format(tripDifference);
            
            // Panggil total unit
            calculateGrandTotalUnits(); 
        }

    </script>

</body>
</html>
